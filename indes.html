<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•´è›Šçº¢åŒ…é“¾æ¥ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-red: #d32f2f;
            --light-red: #ffcdd2;
            --gold: #ffd700;
            --dark-bg: #2c3e50;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'Segoe UI', sans-serif;
        }
        body {
            background: linear-gradient(135deg, #f9f4e6 0%, #f5e9d3 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            border: 1px solid #e6d4b9;
        }
        header {
            background: linear-gradient(to right, var(--primary-red), #f44336);
            color: white;
            text-align: center;
            padding: 30px 20px;
            position: relative;
        }
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
        }
        .red-envelope-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3.5rem;
            opacity: 0.7;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }
        .content {
            display: flex;
            flex-wrap: wrap;
            padding: 25px;
        }
        .form-section, .preview-section {
            flex: 1;
            min-width: 300px;
            padding: 15px;
        }
        .section-title {
            color: var(--primary-red);
            font-size: 1.5rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--light-red);
            display: flex;
            align-items: center;
        }
        .section-title i {
            margin-right: 10px;
        }
        .form-group {
            margin-bottom: 22px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-red);
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        .amount-input {
            position: relative;
        }
        .amount-input span {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: bold;
            color: var(--primary-red);
        }
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }
        .radio-option {
            flex: 1;
            min-width: 140px;
        }
        .radio-option input {
            display: none;
        }
        .radio-option label {
            display: block;
            padding: 18px;
            background-color: #f5f5f5;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            font-weight: 600;
        }
        .radio-option input:checked + label {
            background-color: #ffebee;
            border-color: var(--primary-red);
            color: var(--primary-red);
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.2);
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .checkbox-group input {
            width: 20px;
            height: 20px;
        }
        .checkbox-group label {
            margin-bottom: 0;
            font-weight: normal;
        }
        .btn {
            display: block;
            width: 100%;
            padding: 18px;
            background: linear-gradient(to right, var(--primary-red), #f44336);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 25px;
            letter-spacing: 1px;
        }
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(244, 67, 54, 0.3);
        }
        .btn:active {
            transform: translateY(0);
        }
        .link-display {
            margin-top: 25px;
            background-color: #f9f9f9;
            border-radius: 12px;
            padding: 25px;
            border-left: 6px solid var(--primary-red);
            display: none;
        }
        .link-display.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .link-display h3 {
            margin-bottom: 18px;
            color: #333;
            display: flex;
            align-items: center;
        }
        #generated-link {
            background-color: white;
            padding: 18px;
            border-radius: 10px;
            border: 2px dashed #ccc;
            word-break: break-all;
            font-family: monospace;
            margin-bottom: 20px;
            color: var(--primary-red);
            font-size: 1.1rem;
            line-height: 1.5;
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        .action-btn {
            flex: 1;
            min-width: 140px;
            padding: 15px;
            border-radius: 10px;
            border: none;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        .copy-btn {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
            color: white;
        }
        .test-btn {
            background: linear-gradient(to right, #2196F3, #0D47A1);
            color: white;
        }
        .action-btn:hover {
            transform: translateY(-3px);
            opacity: 0.95;
        }
        .preview-box {
            background: linear-gradient(145deg, #fff9f9 0%, #ffeaea 100%);
            border-radius: 18px;
            padding: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            margin-top: 20px;
            text-align: center;
            border: 3px solid #ffcdd2;
            min-height: 450px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .preview-title {
            font-size: 2.2rem;
            color: var(--primary-red);
            margin-bottom: 20px;
            word-break: break-word;
        }
        .preview-amount {
            font-size: 4.5rem;
            color: #f44336;
            font-weight: bold;
            margin: 25px 0;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.15);
        }
        .negative-amount {
            color: #2E7D32 !important;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .preview-type {
            display: inline-block;
            background-color: var(--light-red);
            color: var(--primary-red);
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: bold;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }
        .preview-desc {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.7;
            font-size: 1.05rem;
            padding: 0 10px;
        }
        .preview-code {
            font-family: 'Courier New', monospace;
            background: linear-gradient(to right, #f5f5f5, #e8e8e8);
            padding: 15px;
            border-radius: 10px;
            font-size: 1.4rem;
            letter-spacing: 3px;
            color: var(--primary-red);
            margin: 20px 0;
            border: 2px solid #ddd;
        }
        .preview-expiry {
            color: #888;
            font-size: 0.95rem;
            margin-top: 25px;
            font-style: italic;
        }
        .info-box {
            background-color: #e8f5e9;
            border-radius: 12px;
            padding: 25px;
            margin-top: 35px;
            border-left: 6px solid #4CAF50;
        }
        .info-box h3 {
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .info-box ul {
            padding-left: 25px;
        }
        .info-box li {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        footer {
            text-align: center;
            padding: 25px;
            color: #777;
            border-top: 1px solid #eee;
            margin-top: 30px;
            font-size: 0.95rem;
            background-color: #f9f9f9;
        }
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
                padding: 15px;
            }
            .form-section, .preview-section {
                padding: 10px;
            }
            header h1 {
                font-size: 2rem;
            }
            .preview-amount {
                font-size: 3.5rem;
            }
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-gift"></i> æ•´è›Šçº¢åŒ…é“¾æ¥ç”Ÿæˆå™¨</h1>
            <p>è‡ªå®šä¹‰çº¢åŒ…é‡‘é¢ï¼ˆæ”¯æŒè´Ÿæ•°æˆ–æå°é‡‘é¢ï¼‰ï¼Œç”Ÿæˆå¯åˆ†äº«çš„é¢†å–é“¾æ¥ï¼Œé€‚åˆæ¶ä½œå‰§æˆ–ç‰¹æ®Šç”¨é€”</p>
            <div class="red-envelope-icon">
                <i class="fas fa-envelope-open-text"></i>
            </div>
        </header>
        
        <div class="content">
            <div class="form-section">
                <h2 class="section-title"><i class="fas fa-sliders-h"></i> è®¾ç½®çº¢åŒ…å‚æ•°</h2>
                
                <div class="form-group">
                    <label for="redpacket-type">çº¢åŒ…ç±»å‹</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="type-cash" name="redpacket-type" value="cash" checked>
                            <label for="type-cash"><i class="fas fa-money-bill-wave"></i> ç°é‡‘çº¢åŒ…</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="type-coupon" name="redpacket-type" value="coupon">
                            <label for="type-coupon"><i class="fas fa-ticket-alt"></i> ä¼˜æƒ åˆ¸</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="type-joke" name="redpacket-type" value="joke">
                            <label for="type-joke"><i class="fas fa-surprise"></i> æ•´è›Šçº¢åŒ…</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="amount">çº¢åŒ…é‡‘é¢ / é¢é¢</label>
                    <div class="amount-input">
                        <input type="number" id="amount" step="0.01" value="-100" placeholder="è¾“å…¥é‡‘é¢ï¼Œæ”¯æŒè´Ÿæ•°">
                        <span>å…ƒ</span>
                    </div>
                    <div style="font-size: 0.9rem; color: #666; margin-top: 8px;">
                        <i class="fas fa-info-circle"></i> å¯è®¾ç½®ä¸ºè´Ÿæ•°ï¼ˆå¦‚ -100ï¼‰æˆ–æå°å€¼ï¼ˆå¦‚ 0.01ï¼‰ï¼Œç”¨äºç‰¹æ®Šæ•ˆæœ
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="redpacket-name">çº¢åŒ…åç§°</label>
                    <input type="text" id="redpacket-name" placeholder="ä¾‹å¦‚ï¼šå‹æƒ…è€ƒéªŒçº¢åŒ…ã€æƒŠå–œä¼˜æƒ åˆ¸" value="å‹æƒ…è€ƒéªŒçº¢åŒ…">
                </div>
                
                <div class="form-group">
                    <label for="description">çº¢åŒ…æè¿° / ç¥ç¦è¯­</label>
                    <textarea id="description" rows="3" placeholder="è¾“å…¥çº¢åŒ…æè¿°æˆ–ç¥ç¦è¯­">ç‚¹å‡»é¢†å–ä½ çš„ä¸“å±çº¢åŒ…ï¼Œå‹æƒ…å¤§è€ƒéªŒï¼çœ‹çœ‹ä½ æ˜¯å¾—åˆ°æƒŠå–œè¿˜æ˜¯æƒŠå“ï¼</textarea>
                </div>
                
                <div class="form-group">
                    <label for="expiry-days">æœ‰æ•ˆå¤©æ•°</label>
                    <select id="expiry-days">
                        <option value="0.04">1å°æ—¶ (ä»…é™å½“å‰)</option>
                        <option value="1">1å¤©</option>
                        <option value="3">3å¤©</option>
                        <option value="7" selected>7å¤©</option>
                        <option value="30">30å¤©</option>
                        <option value="36500">æ°¸ä¹…æœ‰æ•ˆ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>ç‰¹æ®Šæ•ˆæœ</label>
                    <div class="checkbox-group">
                        <input type="checkbox" id="show-confetti">
                        <label for="show-confetti">é¢†å–æ—¶æ˜¾ç¤ºåº†ç¥ç‰¹æ•ˆ</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="play-sound" checked>
                        <label for="play-sound">é¢†å–æ—¶æ’­æ”¾éŸ³æ•ˆ</label>
                    </div>
                </div>
                
                <button id="generate-btn" class="btn">
                    <i class="fas fa-link"></i> ç”Ÿæˆçº¢åŒ…é¢†å–é“¾æ¥
                </button>
                
                <div class="link-display" id="link-section">
                    <h3><i class="fas fa-share-alt"></i> ç”Ÿæˆçš„çº¢åŒ…é“¾æ¥</h3>
                    <div id="generated-link">é“¾æ¥å°†åœ¨æ­¤æ˜¾ç¤º</div>
                    <div class="action-buttons">
                        <button class="action-btn copy-btn" id="copy-btn">
                            <i class="far fa-copy"></i> å¤åˆ¶é“¾æ¥
                        </button>
                        <button class="action-btn test-btn" id="test-btn">
                            <i class="fas fa-external-link-alt"></i> æµ‹è¯•é“¾æ¥
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="preview-section">
                <h2 class="section-title"><i class="fas fa-eye"></i> çº¢åŒ…é¢„è§ˆæ•ˆæœ</h2>
                <div class="preview-box">
                    <div class="preview-title" id="preview-title">å‹æƒ…è€ƒéªŒçº¢åŒ…</div>
                    <div class="preview-type" id="preview-type">æ•´è›Šçº¢åŒ…</div>
                    <div class="preview-amount negative-amount" id="preview-amount">-100.00 å…ƒ</div>
                    <div class="preview-desc" id="preview-desc">ç‚¹å‡»é¢†å–ä½ çš„ä¸“å±çº¢åŒ…ï¼Œå‹æƒ…å¤§è€ƒéªŒï¼çœ‹çœ‹ä½ æ˜¯å¾—åˆ°æƒŠå–œè¿˜æ˜¯æƒŠå“ï¼</div>
                    <div>é¢†å–ä»£ç ï¼š</div>
                    <div class="preview-code" id="preview-code">RP-JOKE-2023</div>
                    <div class="preview-expiry" id="preview-expiry">æœ‰æ•ˆæœŸé™ï¼šé¢†å–å7å¤©å…§æœ‰æ•ˆ</div>
                </div>
                
                <div class="info-box">
                    <h3><i class="fas fa-lightbulb"></i> ä½¿ç”¨è¯´æ˜</h3>
                    <ul>
                        <li><strong>è´Ÿé‡‘é¢çº¢åŒ…</strong>ï¼šè®¾ç½®ä¸ºè´Ÿæ•°ï¼ˆå¦‚ -100ï¼‰ä¼šäº§ç”Ÿâ€œå€’æ¬ æ¬¾â€æ•ˆæœï¼Œé€‚åˆæœ‹å‹é—´æ¶ä½œå‰§ã€‚</li>
                        <li><strong>æå°é‡‘é¢</strong>ï¼šè®¾ç½®ä¸º 0.01ã€0.1 ç­‰æå°å€¼ï¼Œå¯ç”¨äºç‰¹æ®Šæ´»åŠ¨æˆ–è¶£å‘³äº’åŠ¨ã€‚</li>
                        <li><strong>é“¾æ¥åˆ†äº«</strong>ï¼šç”Ÿæˆçš„é“¾æ¥åŒ…å«æ‰€æœ‰çº¢åŒ…å‚æ•°ï¼Œå¯ç›´æ¥åˆ†äº«åˆ°å¾®ä¿¡ã€QQç­‰å¹³å°ã€‚</li>
                        <li><strong>å®Œå…¨æœ¬åœ°</strong>ï¼šæ‰€æœ‰æ“ä½œå‡åœ¨æµè§ˆå™¨ä¸­å®Œæˆï¼Œæ— éœ€ç½‘ç»œè¿æ¥ï¼Œä¿æŠ¤éšç§ã€‚</li>
                        <li><strong>é¢†å–æµ‹è¯•</strong>ï¼šç‚¹å‡»"æµ‹è¯•é“¾æ¥"å¯åœ¨å½“å‰é¡µé¢æ¨¡æ‹Ÿé¢†å–æ•ˆæœã€‚</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>æ•´è›Šçº¢åŒ…é“¾æ¥ç”Ÿæˆå™¨ &copy; 2023 | æœ¬å·¥å…·ä»…ä¾›å¨±ä¹ï¼Œç”Ÿæˆçš„çº¢åŒ…æ— å®é™…é‡‘èä»·å€¼ | æ•°æ®å®Œå…¨ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨</p>
        </footer>
    </div>
    
    <!-- æ·»åŠ ä¸€ä¸ªéšè—çš„éŸ³é¢‘å…ƒç´ ç”¨äºæ’­æ”¾éŸ³æ•ˆ -->
    <audio id="sound-effect" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-unlock-game-notification-253.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        // è·å–DOMå…ƒç´ 
        const amountInput = document.getElementById('amount');
        const redpacketNameInput = document.getElementById('redpacket-name');
        const descriptionInput = document.getElementById('description');
        const expiryDaysSelect = document.getElementById('expiry-days');
        const generateBtn = document.getElementById('generate-btn');
        const linkSection = document.getElementById('link-section');
        const generatedLink = document.getElementById('generated-link');
        const copyBtn = document.getElementById('copy-btn');
        const testBtn = document.getElementById('test-btn');
        const redpacketTypeRadios = document.querySelectorAll('input[name="redpacket-type"]');
        const showConfettiCheckbox = document.getElementById('show-confetti');
        const playSoundCheckbox = document.getElementById('play-sound');
        const soundEffect = document.getElementById('sound-effect');
        
        // é¢„è§ˆå…ƒç´ 
        const previewTitle = document.getElementById('preview-title');
        const previewType = document.getElementById('preview-type');
        const previewAmount = document.getElementById('preview-amount');
        const previewDesc = document.getElementById('preview-desc');
        const previewCode = document.getElementById('preview-code');
        const previewExpiry = document.getElementById('preview-expiry');
        
        // åˆå§‹åŒ–é¢„è§ˆ
        updatePreview();
        
        // ä¸ºè¾“å…¥å…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬å™¨ï¼Œå®æ—¶æ›´æ–°é¢„è§ˆ
        amountInput.addEventListener('input', updatePreview);
        redpacketNameInput.addEventListener('input', updatePreview);
        descriptionInput.addEventListener('input', updatePreview);
        expiryDaysSelect.addEventListener('change', updatePreview);
        redpacketTypeRadios.forEach(radio => {
            radio.addEventListener('change', updatePreview);
        });
        
        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            const amount = parseFloat(amountInput.value).toFixed(2);
            const name = redpacketNameInput.value || "æœªå‘½åçº¢åŒ…";
            const desc = descriptionInput.value || "æ— æè¿°";
            const expiryDays = expiryDaysSelect.value;
            
            // è·å–é€‰ä¸­çš„çº¢åŒ…ç±»å‹
            let selectedType = "cash";
            let typeText = "ç°é‡‘çº¢åŒ…";
            redpacketTypeRadios.forEach(radio => {
                if (radio.checked) {
                    selectedType = radio.value;
                    if (selectedType === "cash") typeText = "ç°é‡‘çº¢åŒ…";
                    else if (selectedType === "coupon") typeText = "ä¼˜æƒ åˆ¸";
                    else if (selectedType === "joke") typeText = "æ•´è›Šçº¢åŒ…";
                }
            });
            
            // ç”Ÿæˆéšæœºé¢†å–ä»£ç 
            const code = generateRedpacketCode();
            
            // æ›´æ–°é¢„è§ˆå†…å®¹
            previewTitle.textContent = name;
            previewType.textContent = typeText;
            previewAmount.textContent = amount + " å…ƒ";
            previewDesc.textContent = desc;
            previewCode.textContent = code;
            
            // æ ¹æ®é‡‘é¢æ­£è´Ÿè®¾ç½®æ ·å¼
            if (parseFloat(amount) < 0) {
                previewAmount.classList.add("negative-amount");
            } else {
                previewAmount.classList.remove("negative-amount");
            }
            
            let expiryText = "æ°¸ä¹…æœ‰æ•ˆ";
            if (expiryDays !== "36500") {
                if (expiryDays === "0.04") {
                    expiryText = "ä»…é™1å°æ—¶å†…æœ‰æ•ˆ";
                } else {
                    expiryText = `é¢†å–å${expiryDays}å¤©å…§æœ‰æ•ˆ`;
                }
            }
            previewExpiry.textContent = `æœ‰æ•ˆæœŸé™ï¼š${expiryText}`;
        }
        
        // ç”Ÿæˆçº¢åŒ…ä»£ç¢¼
        function generateRedpacketCode() {
            const prefix = "RP";
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return `${prefix}-${code.substring(0,4)}-${code.substring(4)}`;
        }
        
        // ç”Ÿæˆçº¢åŒ…é“¾æ¥
        generateBtn.addEventListener('click', function() {
            const amount = parseFloat(amountInput.value).toFixed(2);
            const name = encodeURIComponent(redpacketNameInput.value || "æœªå‘½åçº¢åŒ…");
            const desc = encodeURIComponent(descriptionInput.value || "æ— æè¿°");
            const expiryDays = expiryDaysSelect.value;
            
            // è·å–é€‰ä¸­çš„çº¢åŒ…ç±»å‹
            let selectedType = "cash";
            redpacketTypeRadios.forEach(radio => {
                if (radio.checked) selectedType = radio.value;
            });
            
            // è·å–ç‰¹æ®Šæ•ˆæœè®¾ç½®
            const showConfetti = showConfettiCheckbox.checked;
            const playSound = playSoundCheckbox.checked;
            
            // ç”Ÿæˆéšæœºä»£ç¢¼
            const code = generateRedpacketCode();
            
            // åˆ›å»ºæ¨¡æ‹Ÿé“¾æ¥ - ä½¿ç”¨javascript:åè®®è°ƒç”¨å±•ç¤ºå‡½æ•°
            // æ³¨æ„ï¼šåœ¨å®é™…åˆ†äº«æ—¶ï¼Œå¯ä»¥å°†æ­¤é“¾æ¥æ›¿æ¢ä¸ºæŒ‡å‘å®é™…æ‰˜ç®¡é¡µé¢çš„URL
            const link = `javascript:showRedPacket("${selectedType}", "${amount}", "${name}", "${desc}", "${expiryDays}", "${code}", ${showConfetti}, ${playSound})`;
            
            // æ˜¾ç¤ºç”Ÿæˆçš„é“¾æ¥
            generatedLink.textContent = link;
            linkSection.classList.add('show');
            
            // æ»šåŠ¨åˆ°é€£çµåŒºåŸŸ
            linkSection.scrollIntoView({ behavior: 'smooth' });
        });
        
        // å¤åˆ¶é“¾æ¥åŠŸèƒ½
        copyBtn.addEventListener('click', function() {
            const linkText = generatedLink.textContent;
            
            // ä½¿ç”¨Clipboard APIå¤åˆ¶æ–‡å­—
            navigator.clipboard.writeText(linkText).then(function() {
                // æ˜¾ç¤ºæˆåŠŸè¨Šæ¯
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                copyBtn.style.background = 'linear-gradient(to right, #2E7D32, #1B5E20)';
                
                setTimeout(function() {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = '';
                }, 2000);
            }).catch(function(err) {
                console.error('å¤åˆ¶å¤±è´¥: ', err);
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement("textarea");
                textArea.value = linkText;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("copy");
                document.body.removeChild(textArea);
                
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        });
        
        // æµ‹è¯•é“¾æ¥åŠŸèƒ½ - åœ¨å½“å‰é¡µé¢æ˜¾ç¤ºçº¢åŒ…
        testBtn.addEventListener('click', function() {
            const link = generatedLink.textContent;
            if (link && link !== 'é“¾æ¥å°†åœ¨æ­¤æ˜¾ç¤º') {
                // ä»é“¾æ¥ä¸­æå–å‚æ•°å¹¶è°ƒç”¨æ˜¾ç¤ºå‡½æ•°
                const params = extractParamsFromLink(link);
                showRedPacket(
                    params.type, 
                    params.amount, 
                    params.name, 
                    params.desc, 
                    params.expiry, 
                    params.code,
                    params.showConfetti,
                    params.playSound
                );
            } else {
                // å¦‚æœæ²¡æœ‰ç”Ÿæˆé“¾æ¥ï¼Œä½¿ç”¨å½“å‰è¡¨å•å€¼æµ‹è¯•
                const amount = parseFloat(amountInput.value).toFixed(2);
                const name = encodeURIComponent(redpacketNameInput.value || "æœªå‘½åçº¢åŒ…");
                const desc = encodeURIComponent(descriptionInput.value || "æ— æè¿°");
                const expiryDays = expiryDaysSelect.value;
                let selectedType = "cash";
                redpacketTypeRadios.forEach(radio => {
                    if (radio.checked) selectedType = radio.value;
                });
                const showConfetti = showConfettiCheckbox.checked;
                const playSound = playSoundCheckbox.checked;
                const code = generateRedpacketCode();
                
                showRedPacket(selectedType, amount, name, desc, expiryDays, code, showConfetti, playSound);
            }
        });
        
        // ä»é“¾æ¥ä¸­æå–å‚æ•°
        function extractParamsFromLink(link) {
            try {
                // ä»javascript:é“¾æ¥ä¸­æå–å‚æ•°éƒ¨åˆ†
                const paramsStr = link.split('("')[1].split('")')[0];
                const paramsArray = paramsStr.split('", "');
                
                return {
                    type: paramsArray[0],
                    amount: paramsArray[1],
                    name: paramsArray[2],
                    desc: paramsArray[3],
                    expiry: paramsArray[4],
                    code: paramsArray[5],
                    showConfetti: paramsArray[6] === 'true',
                    playSound: paramsArray[7] === 'true'
                };
            } catch (e) {
                // å¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é»˜è®¤å€¼
                return {
                    type: "cash",
                    amount: "0.00",
                    name: "æµ‹è¯•çº¢åŒ…",
                    desc: "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•çº¢åŒ…",
                    expiry: "7",
                    code: "TEST-CODE",
                    showConfetti: true,
                    playSound: true
                };
            }
        }
        
        // æ˜¾ç¤ºçº¢åŒ…çš„å‡½æ•° - è¿™ä¸ªå‡½æ•°ä¼šè¢«ç”Ÿæˆçš„é“¾æ¥è°ƒç”¨
        window.showRedPacket = function(type, amount, name, desc, expiry, code, showConfetti, playSound) {
            // è§£ç URLç¼–ç çš„å‚æ•°
            const decodedName = decodeURIComponent(name);
            const decodedDesc = decodeURIComponent(desc);
            
            // æ ¹æ®ç±»å‹è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬
            let typeText = "ç°é‡‘çº¢åŒ…";
            if (type === "coupon") typeText = "ä¼˜æƒ åˆ¸";
            else if (type === "joke") typeText = "æ•´è›Šçº¢åŒ…";
            
            // è®¾ç½®æœ‰æ•ˆæœŸé™æ–‡æœ¬
            let expiryText = "æ°¸ä¹…æœ‰æ•ˆ";
            if (expiry !== "36500") {
                if (expiry === "0.04") {
                    expiryText = "ä»…é™1å°æ—¶å†…æœ‰æ•ˆ";
                } else {
                    expiryText = `é¢†å–å${expiry}å¤©å…§æœ‰æ•ˆ`;
                }
            }
            
            // æ’­æ”¾éŸ³æ•ˆï¼ˆå¦‚æœå¯ç”¨ï¼‰
            if (playSound && soundEffect) {
                soundEffect.currentTime = 0;
                soundEffect.play().catch(e => console.log("éŸ³æ•ˆæ’­æ”¾å¤±è´¥:", e));
            }
            
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                z-index: 9999;
                display: flex;
                justify-content: center;
                align-items: center;
                animation: fadeIn 0.5s;
            `;
            
            // æ ¹æ®é‡‘é¢æ­£è´Ÿè®¾ç½®ä¸åŒæ ·å¼å’Œæ–‡æ¡ˆ
            const isNegative = parseFloat(amount) < 0;
            const amountColor = isNegative ? '#2E7D32' : '#f44336';
            const amountText = isNegative ? `${amount} å…ƒ<br><small style="font-size: 1.2rem;">(ä½ å€’æ¬ æˆ‘${Math.abs(parseFloat(amount))}å…ƒ)</small>` : `${amount} å…ƒ`;
            const titleText = isNegative ? "ğŸ˜± å‹æƒ…è€ƒéªŒç»“æœ" : "ğŸ‰ çº¢åŒ…é¢†å–æˆåŠŸ";
            const buttonText = isNegative ? "ç¡®è®¤æ¬ æ¬¾å¹¶å…³é—­" : "é¢†å–æˆåŠŸï¼ç‚¹å‡»å…³é—­";
            
            modal.innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 20px; max-width: 500px; width: 90%; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: popIn 0.6s;">
                    <h2 style="color: ${amountColor}; margin-bottom: 10px; font-size: 2.2rem;">${titleText}</h2>
                    <div style="margin: 20px 0;">
                        <span style="background: ${isNegative ? '#c8e6c9' : '#ffcdd2'}; color: ${isNegative ? '#2E7D32' : '#d32f2f'}; padding: 8px 20px; border-radius: 20px; font-weight: bold;">${typeText}</span>
                    </div>
                    <div style="font-size: 4rem; color: ${amountColor}; font-weight: bold; margin: 25px 0; line-height: 1.2;">${amountText}</div>
                    <h3 style="color: #333; margin-bottom: 15px;">${decodedName}</h3>
                    <p style="color: #666; margin: 20px 0; line-height: 1.6; font-size: 1.1rem;">${decodedDesc}</p>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 12px; margin: 20px 0;">
                        <div style="font-size: 0.95rem; color: #888;">é¢†å–ä»£ç </div>
                        <div style="font-family: 'Courier New', monospace; font-size: 1.5rem; letter-spacing: 3px; color: #d32f2f; margin-top: 5px;">${code}</div>
                    </div>
                    <div style="color: #888; font-size: 0.95rem; margin-bottom: 25px;">æœ‰æ•ˆæœŸé™ï¼š${expiryText}</div>
                    <button id="close-redpacket" style="padding: 15px 50px; background: ${isNegative ? '#2E7D32' : '#4CAF50'}; color: white; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: all 0.3s;">
                        ${buttonText}
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // æ·»åŠ å…³é—­åŠŸèƒ½
            modal.querySelector('#close-redpacket').addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            // ç‚¹å‡»èƒŒæ™¯ä¹Ÿå¯å…³é—­
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
            
            // æ·»åŠ CSSåŠ¨ç”»
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes popIn {
                    0% { transform: scale(0.8); opacity: 0; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
        };
        
        // åˆå§‹åŒ–æ—¶æ›´æ–°ä¸€æ¬¡é¢„è§ˆ
        updatePreview();
    </script>
</body>
</html>
