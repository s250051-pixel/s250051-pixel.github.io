<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pneumonoultramicroscopicsilicovolcanoconiosis SuperMap</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&callback=initMap&libraries=places,visualization" async defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --volcano-red: #ff4d4d;
            --volcano-orange: #ff8533;
            --volcano-yellow: #ffcc00;
            --volcano-purple: #8a2be2;
            --deep-blue: #0a1931;
            --lava-glow: rgba(255, 107, 53, 0.8);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial Nova', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #f0f0f0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 77, 77, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 133, 51, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(138, 43, 226, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* 浮动粒子背景 */
        .floating-particle {
            position: fixed;
            background: var(--volcano-red);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite linear;
            z-index: -1;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20px, 50px) rotate(90deg); }
            50% { transform: translate(40px, 0) rotate(180deg); }
            75% { transform: translate(20px, -50px) rotate(270deg); }
        }
        
        .main-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* 增强头部 */
        .super-header {
            background: rgba(10, 10, 10, 0.95);
            padding: 15px 30px;
            border-bottom: 3px solid var(--volcano-red);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            box-shadow: 0 5px 30px rgba(255, 77, 77, 0.3);
            position: relative;
            z-index: 100;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .logo {
            background: linear-gradient(45deg, var(--volcano-red), var(--volcano-orange), var(--volcano-yellow));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 1px;
            text-shadow: 0 0 20px rgba(255, 77, 77, 0.5);
        }
        
        .logo-short {
            font-size: 1.2rem;
            color: var(--volcano-yellow);
            font-weight: 300;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            border: 1px solid var(--volcano-purple);
        }
        
        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        .user-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .notification-badge {
            position: relative;
            cursor: pointer;
        }
        
        .notification-count {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--volcano-red);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        /* 增强侧边栏 */
        .super-sidebar {
            position: fixed;
            left: 0;
            top: 80px;
            width: 400px;
            height: calc(100vh - 80px);
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(10px);
            border-right: 2px solid var(--volcano-orange);
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.7);
            z-index: 90;
            transform: translateX(-100%);
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            overflow-y: auto;
            padding: 25px;
        }
        
        .super-sidebar.active {
            transform: translateX(0);
        }
        
        .toggle-sidebar {
            position: fixed;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            background: var(--volcano-red);
            color: white;
            border: none;
            border-radius: 0 10px 10px 0;
            padding: 15px 10px;
            cursor: pointer;
            z-index: 89;
            box-shadow: 3px 0 15px rgba(255, 77, 77, 0.5);
            transition: all 0.3s;
        }
        
        .toggle-sidebar:hover {
            padding-left: 15px;
        }
        
        .sidebar-section {
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 133, 51, 0.3);
            transition: transform 0.3s, border-color 0.3s;
        }
        
        .sidebar-section:hover {
            transform: translateY(-5px);
            border-color: var(--volcano-orange);
            box-shadow: 0 10px 25px rgba(255, 133, 51, 0.2);
        }
        
        .section-title {
            color: var(--volcano-yellow);
            font-size: 1.4rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 204, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        /* 增强地图容器 */
        .super-map-container {
            flex: 1;
            position: relative;
            transition: margin-left 0.4s;
        }
        
        .super-map-container.sidebar-active {
            margin-left: 400px;
        }
        
        #superMap {
            width: 100%;
            height: 100%;
        }
        
        /* 增强控制面板 */
        .super-control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            background: rgba(20, 20, 30, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border: 2px solid var(--volcano-purple);
            transform: translateY(0);
            transition: transform 0.3s;
        }
        
        .super-control-panel:hover {
            transform: translateY(-5px);
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-label {
            display: block;
            color: var(--volcano-yellow);
            margin-bottom: 8px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        /* 增强滑块 */
        .super-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--volcano-red), var(--volcano-orange), var(--volcano-yellow));
            outline: none;
        }
        
        .super-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--volcano-purple);
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 10px rgba(138, 43, 226, 0.8);
        }
        
        /* 增强按钮 */
        .super-btn {
            background: linear-gradient(45deg, var(--volcano-red), var(--volcano-purple));
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(255, 77, 77, 0.3);
            width: 100%;
            margin-bottom: 10px;
        }
        
        .super-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 77, 77, 0.5);
            background: linear-gradient(45deg, var(--volcano-purple), var(--volcano-red));
        }
        
        .super-btn:active {
            transform: translateY(0);
        }
        
        .super-btn.gold {
            background: linear-gradient(45deg, #ffcc00, #ff9900);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.3);
        }
        
        .super-btn.gold:hover {
            box-shadow: 0 8px 20px rgba(255, 204, 0, 0.5);
        }
        
        /* 增强模式切换 */
        .mode-switcher {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: transparent;
            color: #aaa;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: var(--volcano-red);
            color: white;
            box-shadow: 0 0 15px rgba(255, 77, 77, 0.5);
        }
        
        /* 增强数据可视化 */
        .data-viz-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }
        
        .viz-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .viz-bar {
            height: 10px;
            background: linear-gradient(to right, var(--volcano-red), var(--volcano-orange));
            border-radius: 5px;
            margin-top: 5px;
        }
        
        /* 增强标记 */
        .super-marker {
            position: absolute;
            z-index: 5;
            cursor: pointer;
            transition: transform 0.3s;
            filter: drop-shadow(0 0 10px var(--volcano-yellow));
        }
        
        .super-marker:hover {
            transform: scale(1.3) rotate(15deg);
        }
        
        /* 增强搜索 */
        .super-search {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 500px;
            max-width: 80%;
            z-index: 10;
        }
        
        .search-box {
            display: flex;
            background: rgba(20, 20, 30, 0.95);
            border-radius: 50px;
            padding: 5px;
            border: 2px solid var(--volcano-orange);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
        }
        
        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            padding: 15px 20px;
            color: white;
            font-size: 1.1rem;
            outline: none;
        }
        
        .search-btn {
            background: var(--volcano-red);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-btn:hover {
            background: var(--volcano-orange);
            transform: rotate(90deg);
        }
        
        /* 增强信息窗口 */
        .super-info-window {
            position: absolute;
            background: rgba(20, 20, 30, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            width: 350px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8);
            border: 2px solid var(--volcano-red);
            z-index: 20;
            transform: translate(-50%, -100%);
            top: 0;
            left: 0;
            display: none;
        }
        
        .info-title {
            color: var(--volcano-yellow);
            font-size: 1.5rem;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 204, 0, 0.3);
        }
        
        .info-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            color: var(--volcano-red);
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        /* 增强AR模式 */
        .ar-mode {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 10;
        }
        
        .ar-toggle {
            background: linear-gradient(45deg, #00ccff, #0088ff);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 10px 25px rgba(0, 204, 255, 0.4);
            transition: all 0.3s;
        }
        
        .ar-toggle:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 204, 255, 0.6);
        }
        
        /* 增强时间线 */
        .time-travel {
            position: absolute;
            bottom: 30px;
            left: 30px;
            z-index: 10;
            background: rgba(20, 20, 30, 0.9);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border: 2px solid var(--volcano-purple);
        }
        
        .time-slider {
            margin: 15px 0;
        }
        
        .time-label {
            display: flex;
            justify-content: space-between;
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 1200px) {
            .super-sidebar {
                width: 350px;
            }
            
            .super-control-panel {
                width: 280px;
            }
        }
        
        @media (max-width: 768px) {
            .super-sidebar {
                width: 100%;
            }
            
            .super-map-container.sidebar-active {
                margin-left: 0;
            }
            
            .super-control-panel {
                width: 250px;
                top: 10px;
                right: 10px;
            }
            
            .super-search {
                width: 90%;
            }
            
            .logo {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- 浮动粒子背景 -->
    <div id="particles"></div>
    
    <!-- 主容器 -->
    <div class="main-container">
        <!-- 增强头部 -->
        <header class="super-header">
            <div class="logo-section">
                <div>
                    <h1 class="logo">Pneumonoultramicroscopicsilicovolcanoconiosis SuperMap</h1>
                    <p class="logo-short">超越Google Maps的下一代地图体验</p>
                </div>
                <div class="status-indicator">
                    <div class="pulse-dot"></div>
                    <span>实时数据同步中...</span>
                </div>
            </div>
            
            <div class="user-controls">
                <div class="notification-badge">
                    <i class="fas fa-bell fa-lg" style="color: var(--volcano-yellow);"></i>
                    <span class="notification-count">3</span>
                </div>
                <div class="user-avatar">
                    <i class="fas fa-user-astronaut fa-2x" style="color: var(--volcano-red);"></i>
                </div>
            </div>
        </header>
        
        <!-- 增强侧边栏 -->
        <button class="toggle-sidebar" id="toggleSidebar">
            <i class="fas fa-chevron-right"></i>
        </button>
        
        <aside class="super-sidebar" id="superSidebar">
            <div class="sidebar-section">
                <h3 class="section-title"><i class="fas fa-layer-group"></i> 增强图层</h3>
                <div class="control-group">
                    <label class="control-label">地形增强</label>
                    <input type="range" class="super-slider" id="terrainSlider" min="0" max="100" value="75">
                </div>
                <div class="control-group">
                    <label class="control-label">实时天气覆盖</label>
                    <div class="mode-switcher">
                        <button class="mode-btn active" data-layer="weather">开启</button>
                        <button class="mode-btn" data-layer="weather">关闭</button>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">夜间灯光指数</label>
                    <div class="data-viz-container">
                        <div class="viz-item">
                            <span>当前区域</span>
                            <span>8.7/10</span>
                        </div>
                        <div class="viz-bar" style="width: 87%;"></div>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <h3 class="section-title"><i class="fas fa-bolt"></i> 实时数据源</h3>
                <button class="super-btn">
                    <i class="fas fa-satellite"></i>
                    <span>卫星影像更新</span>
                </button>
                <button class="super-btn">
                    <i class="fas fa-car"></i>
                    <span>交通流预测</span>
                </button>
                <button class="super-btn">
                    <i class="fas fa-wind"></i>
                    <span>大气质量指数</span>
                </button>
                <button class="super-btn gold">
                    <i class="fas fa-crown"></i>
                    <span>AI预测模式</span>
                </button>
            </div>
            
            <div class="sidebar-section">
                <h3 class="section-title"><i class="fas fa-users"></i> 社区协作</h3>
                <div class="control-group">
                    <label class="control-label">实时用户密度</label>
                    <div class="data-viz-container">
                        <div class="viz-item">
                            <span>当前在线用户</span>
                            <span id="onlineUsers">1,247</span>
                        </div>
                        <div class="viz-item">
                            <span>共享标记</span>
                            <span>3,891</span>
                        </div>
                    </div>
                </div>
                <button class="super-btn">
                    <i class="fas fa-share-alt"></i>
                    <span>分享实时位置</span>
                </button>
            </div>
            
            <div class="sidebar-section">
                <h3 class="section-title">
                    <i class="fas fa-chart-line"></i>
                    <span>数据洞察</span>
                    <span class="notification-count">NEW</span>
                </h3>
                <div class="data-viz-container">
                    <p>基于AI分析，您当前位置：</p>
                    <div class="viz-item">
                        <span>推荐指数</span>
                        <span class="stat-value">92%</span>
                    </div>
                    <div class="viz-item">
                        <span>人流预测</span>
                        <span class="stat-value">中</span>
                    </div>
                    <div class="viz-item">
                        <span>最佳访问时间</span>
                        <span class="stat-value">14:30-16:00</span>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- 增强地图容器 -->
        <div class="super-map-container" id="mapContainer">
            <!-- 增强搜索框 -->
            <div class="super-search">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="搜索地点或输入增强指令（如：'显示3D建筑'、'预测交通'）">
                    <button class="search-btn" id="searchBtn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
            
            <!-- 增强控制面板 -->
            <div class="super-control-panel">
                <div class="control-group">
                    <label class="control-label">地图增强模式</label>
                    <div class="mode-switcher">
                        <button class="mode-btn active" data-mode="standard">标准</button>
                        <button class="mode-btn" data-mode="topographic">地形</button>
                        <button class="mode-btn" data-mode="night">夜视</button>
                        <button class="mode-btn" data-mode="thermal">热力图</button>
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">3D增强强度</label>
                    <input type="range" class="super-slider" id="enhance3dSlider" min="0" max="100" value="60">
                </div>
                
                <button class="super-btn" id="toggle3d">
                    <i class="fas fa-cube"></i>
                    <span>切换3D增强视图</span>
                </button>
                
                <button class="super-btn" id="timeTravel">
                    <i class="fas fa-history"></i>
                    <span>时间旅行模式</span>
                </button>
                
                <button class="super-btn gold" id="aiPredict">
                    <i class="fas fa-brain"></i>
                    <span>AI未来预测</span>
                </button>
            </div>
            
            <!-- 增强信息窗口 -->
            <div class="super-info-window" id="infoWindow">
                <h3 class="info-title" id="infoTitle">增强位置信息</h3>
                <p id="infoDescription">正在加载增强数据...</p>
                <div class="info-stats">
                    <div class="stat-item">
                        <div class="stat-label">实时评分</div>
                        <div class="stat-value" id="infoRating">9.2</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">人流密度</div>
                        <div class="stat-value" id="infoDensity">中</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">天气状况</div>
                        <div class="stat-value" id="infoWeather">晴</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">增强数据</div>
                        <div class="stat-value" id="infoData">87%</div>
                    </div>
                </div>
                <button class="super-btn" id="moreInfoBtn">
                    <i class="fas fa-chart-bar"></i>
                    <span>查看更多分析</span>
                </button>
            </div>
            
            <!-- AR模式 -->
            <div class="ar-mode">
                <button class="ar-toggle" id="arToggle">
                    <i class="fas fa-vr-cardboard"></i>
                    <span>AR增强现实模式</span>
                </button>
            </div>
            
            <!-- 时间旅行 -->
            <div class="time-travel" id="timeTravelPanel" style="display: none;">
                <h3 class="section-title"><i class="fas fa-history"></i> 时间旅行</h3>
                <p>探索此位置的历史变化</p>
                <input type="range" class="time-slider super-slider" id="timeSlider" min="2000" max="2023" value="2023">
                <div class="time-label">
                    <span>2000年</span>
                    <span id="currentYear">2023年</span>
                </div>
                <button class="super-btn" id="closeTimeTravel">
                    <i class="fas fa-times"></i>
                    <span>关闭时间旅行</span>
                </button>
            </div>
            
            <!-- 地图容器 -->
            <div id="superMap"></div>
        </div>
    </div>
    
    <script>
        // 初始化变量
        let map;
        let markers = [];
        let infoWindow;
        let is3DEnabled = false;
        let isSidebarOpen = false;
        let currentMode = 'standard';
        let arEnabled = false;
        
        // 创建浮动粒子
        function createFloatingParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 30;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('floating-particle');
                
                // 随机大小
                const size = Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // 随机颜色
                const colors = ['#ff4d4d', '#ff8533', '#ffcc00', '#8a2be2'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                particle.style.background = color;
                
                // 随机位置
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                // 随机动画延迟
                particle.style.animationDelay = `${Math.random() * 20}s`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // 初始化地图
        function initMap() {
            // 创建地图
            map = new google.maps.Map(document.getElementById('superMap'), {
                center: { lat: 25.0330, lng: 121.5654 }, // 台北
                zoom: 12,
                mapTypeId: 'roadmap',
                styles: getMapStyle(currentMode),
                tilt: 0,
                heading: 0
            });
            
            // 创建初始标记
            createEnhancedMarkers();
            
            // 初始化信息窗口
            infoWindow = document.getElementById('infoWindow');
            
            // 添加地图点击事件
            map.addListener('click', function(event) {
                showInfoWindow(event.latLng, "点击位置");
            });
            
            // 添加自定义控件
            addCustomControls();
            
            // 创建浮动粒子
            createFloatingParticles();
            
            // 模拟实时数据更新
            simulateRealTimeData();
        }
        
        // 获取地图样式
        function getMapStyle(mode) {
            const baseStyle = [
                { elementType: "geometry", stylers: [{ color: "#1d2c4d" }] },
                { elementType: "labels.text.fill", stylers: [{ color: "#8ec3b9" }] },
                { elementType: "labels.text.stroke", stylers: [{ color: "#1a3646" }] }
            ];
            
            // 根据模式添加不同样式
            if (mode === 'night') {
                baseStyle.push(
                    { elementType: "geometry", stylers: [{ color: "#0a1931" }] },
                    { featureType: "road", stylers: [{ color: "#1a3a5f" }] },
                    { featureType: "poi", stylers: [{ visibility: "off" }] }
                );
            } else if (mode === 'thermal') {
                baseStyle.push(
                    { featureType: "water", stylers: [{ color: "#ff4d4d" }] },
                    { featureType: "landscape", stylers: [{ color: "#ff8533" }] }
                );
            }
            
            return baseStyle;
        }
        
        // 创建增强标记
        function createEnhancedMarkers() {
            const locations = [
                { lat: 25.0330, lng: 121.5654, title: "台北101", type: "landmark", rating: 9.5 },
                { lat: 25.0385, lng: 121.5645, title: "台北车站", type: "transport", rating: 8.2 },
                { lat: 25.0225, lng: 121.5485, title: "中正纪念堂", type: "cultural", rating: 9.0 },
                { lat: 25.1025, lng: 121.5485, title: "士林夜市", type: "food", rating: 9.8 },
                { lat: 25.0855, lng: 121.5245, title: "故宫博物院", type: "cultural", rating: 9.7 },
                { lat: 24.9975, lng: 121.5815, title: "象山观景台", type: "nature", rating: 9.3 }
            ];
            
            locations.forEach(location => {
                // 创建自定义标记
                const marker = new google.maps.Marker({
                    position: { lat: location.lat, lng: location.lng },
                    map: map,
                    title: location.title,
                    icon: getCustomIcon(location.type),
                    animation: google.maps.Animation.DROP
                });
                
                // 添加点击事件
                marker.addListener('click', function() {
                    showInfoWindow(
                        marker.getPosition(),
                        location.title,
                        location.type,
                        location.rating
                    );
                    
                    // 动画效果
                    marker.setAnimation(google.maps.Animation.BOUNCE);
                    setTimeout(() => {
                        marker.setAnimation(null);
                    }, 700);
                });
                
                markers.push(marker);
            });
        }
        
        // 获取自定义图标
        function getCustomIcon(type) {
            const icons = {
                landmark: { url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png" },
                transport: { url: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png" },
                cultural: { url: "https://maps.google.com/mapfiles/ms/icons/yellow-dot.png" },
                food: { url: "https://maps.google.com/mapfiles/ms/icons/green-dot.png" },
                nature: { url: "https://maps.google.com/mapfiles/ms/icons/purple-dot.png" }
            };
            
            return icons[type] || { url: "https://maps.google.com/mapfiles/ms/icons/red-dot.png" };
        }
        
        // 显示增强信息窗口
        function showInfoWindow(position, title, type = "general", rating = 8.5) {
            const lat = position.lat();
            const lng = position.lng();
            
            // 更新信息窗口内容
            document.getElementById('infoTitle').textContent = title;
            
            // 生成增强描述
            const descriptions = {
                landmark: "这是该区域的重要地标，具有高度的文化和社会价值。",
                transport: "交通枢纽，实时数据显示当前人流适中，预测未来1小时将增加30%。",
                cultural: "文化场所，AI分析显示当前为最佳参观时间，等待时间较短。",
                food: "美食热点，社区评分极高，推荐尝试当地特色小吃。",
                nature: "自然景观，空气质量优良，适合户外活动。",
                general: "增强数据显示此位置具有较高访问价值，周边设施完善。"
            };
            
            document.getElementById('infoDescription').textContent = descriptions[type] || descriptions.general;
            
            // 更新统计数据
            document.getElementById('infoRating').textContent = rating.toFixed(1);
            
            // 随机生成一些增强数据
            document.getElementById('infoDensity').textContent = 
                ["低", "中", "高"][Math.floor(Math.random() * 3)];
            document.getElementById('infoWeather').textContent = 
                ["晴", "多云", "小雨"][Math.floor(Math.random() * 3)];
            document.getElementById('infoData').textContent = 
                `${Math.floor(Math.random() * 30) + 70}%`;
            
            // 显示信息窗口
            infoWindow.style.display = 'block';
            
            // 计算位置
            const projection = map.getProjection();
            const pixelPosition = projection.fromLatLngToDivPixel(position);
            
            infoWindow.style.left = `${pixelPosition.x}px`;
            infoWindow.style.top = `${pixelPosition.y - infoWindow.offsetHeight - 20}px`;
            
            // 添加关闭按钮功能
            document.getElementById('moreInfoBtn').onclick = function() {
                alert(`正在加载${title}的深度分析数据...`);
            };
        }
        
        // 添加自定义控件
        function addCustomControls() {
            // 3D增强切换
            document.getElementById('toggle3d').addEventListener('click', function() {
                is3DEnabled = !is3DEnabled;
                
                if (is3DEnabled) {
                    map.setTilt(45);
                    this.innerHTML = '<i class="fas fa-cube"></i><span>关闭3D增强视图</span>';
                    alert("3D增强视图已开启！地图现在具有深度和透视效果。");
                } else {
                    map.setTilt(0);
                    this.innerHTML = '<i class="fas fa-cube"></i><span>切换3D增强视图</span>';
                }
            });
            
            // 时间旅行模式
            document.getElementById('timeTravel').addEventListener('click', function() {
                const panel = document.getElementById('timeTravelPanel');
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
                
                if (panel.style.display === 'block') {
                    alert("时间旅行模式已激活！滑动滑块查看历史地图数据。");
                }
            });
            
            // 关闭时间旅行
            document.getElementById('closeTimeTravel').addEventListener('click', function() {
                document.getElementById('timeTravelPanel').style.display = 'none';
            });
            
            // AI预测
            document.getElementById('aiPredict').addEventListener('click', function() {
                alert("AI预测模式启动！\n基于机器学习算法，预测未来2小时：\n- 交通流量变化: +35%\n- 人流聚集点: 市中心广场\n- 推荐路线: 环城高速\n- 天气趋势: 保持晴朗");
            });
            
            // AR模式
            document.getElementById('arToggle').addEventListener('click', function() {
                arEnabled = !arEnabled;
                
                if (arEnabled) {
                    this.innerHTML = '<i class="fas fa-vr-cardboard"></i><span>关闭AR增强现实</span>';
                    alert("AR模式已激活！请将设备摄像头对准周围环境查看增强信息。");
                } else {
                    this.innerHTML = '<i class="fas fa-vr-cardboard"></i><span>AR增强现实模式</span>';
                }
            });
            
            // 模式切换
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    
                    // 移除所有active类
                    this.parentNode.querySelectorAll('.mode-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    
                    // 添加active类到当前按钮
                    this.classList.add('active');
                    
                    // 更新地图样式
                    currentMode = mode;
                    map.setOptions({ styles: getMapStyle(currentMode) });
                    
                    // 显示提示
                    const modeNames = {
                        standard: "标准模式",
                        topographic: "地形增强模式",
                        night: "夜视模式",
                        thermal: "热力图模式"
                    };
                    
                    alert(`已切换到${modeNames[mode]}！`);
                });
            });
            
            // 侧边栏切换
            document.getElementById('toggleSidebar').addEventListener('click', function() {
                const sidebar = document.getElementById('superSidebar');
                const mapContainer = document.getElementById('mapContainer');
                
                isSidebarOpen = !isSidebarOpen;
                
                if (isSidebarOpen) {
                    sidebar.classList.add('active');
                    mapContainer.classList.add('sidebar-active');
                    this.innerHTML = '<i class="fas fa-chevron-left"></i>';
                } else {
                    sidebar.classList.remove('active');
                    mapContainer.classList.remove('sidebar-active');
                    this.innerHTML = '<i class="fas fa-chevron-right"></i>';
                }
            });
            
            // 搜索功能
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });
            
            // 时间滑块
            document.getElementById('timeSlider').addEventListener('input', function() {
                document.getElementById('currentYear').textContent = `${this.value}年`;
                
                // 模拟地图变化
                const intensity = (this.value - 2000) / 23; // 2000-2023
                document.getElementById('enhance3dSlider').value = intensity * 100;
            });
            
            // 3D增强滑块
            document.getElementById('enhance3dSlider').addEventListener('input', function() {
                if (is3DEnabled) {
                    const tiltValue = 45 * (this.value / 100);
                    map.setTilt(tiltValue);
                }
            });
            
            // 在线用户数更新
            setInterval(() => {
                const userElement = document.getElementById('onlineUsers');
                const currentUsers = parseInt(userElement.textContent.replace(',', ''));
                const change = Math.floor(Math.random() * 21) - 10; // -10 到 +10
                const newUsers = Math.max(1000, currentUsers + change);
                userElement.textContent = newUsers.toLocaleString();
            }, 5000);
        }
        
        // 执行搜索
        function performSearch() {
            const query = document.getElementById('searchInput').value.trim();
            
            if (!query) return;
            
            // 检查是否为增强指令
            if (query.includes('3D') || query.includes('三维') || query.includes('立体')) {
                is3DEnabled = true;
                map.setTilt(45);
                document.getElementById('toggle3d').innerHTML = '<i class="fas fa-cube"></i><span>关闭3D增强视图</span>';
                alert("3D增强视图已根据您的指令开启！");
            } else if (query.includes('预测') || query.includes('AI') || query.includes('未来')) {
                alert("AI预测分析启动！\n基于当前数据和历史模式，预测结果如下：\n1. 交通状况将在30分钟内改善\n2. 推荐避开市中心路段\n3. 天气保持稳定\n4. 人流高峰期: 17:00-19:00");
            } else if (query.includes('夜间') || query.includes('夜视') || query.includes('夜晚')) {
                currentMode = 'night';
                map.setOptions({ styles: getMapStyle(currentMode) });
                alert("已切换到夜视模式！");
            } else {
                // 普通搜索
                const geocoder = new google.maps.Geocoder();
                
                geocoder.geocode({ address: query }, function(results, status) {
                    if (status === 'OK') {
                        map.setCenter(results[0].geometry.location);
                        map.setZoom(15);
                        
                        // 显示信息窗口
                        showInfoWindow(
                            results[0].geometry.location,
                            query,
                            "general",
                            8.0 + Math.random() * 2
                        );
                        
                        alert(`已找到"${query}"！增强数据显示此位置评分为8.5以上。`);
                    } else {
                        alert(`无法找到"${query}"。请尝试其他搜索词。`);
                    }
                });
            }
        }
        
        // 模拟实时数据更新
        function simulateRealTimeData() {
            // 随机更新一些数据
            setInterval(() => {
                // 随机更新在线用户数
                const userElement = document.getElementById('onlineUsers');
                if (userElement) {
                    const currentUsers = parseInt(userElement.textContent.replace(',', ''));
                    const change = Math.floor(Math.random() * 21) - 5; // -5 到 +15
                    const newUsers = Math.max(1000, currentUsers + change);
                    userElement.textContent = newUsers.toLocaleString();
                }
                
                // 随机改变状态指示器颜色
                const dot = document.querySelector('.pulse-dot');
                if (dot) {
                    const colors = ['#00ff88', '#ffcc00', '#ff4d4d', '#0088ff'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    dot.style.background = randomColor;
                }
            }, 3000);
        }
        
        // 页面加载完成
        window.onload = function() {
            // 如果Google Maps API加载失败，显示备用消息
            setTimeout(() => {
                if (!map) {
                    alert("注意：Google Maps API未加载。请确保您已替换YOUR_API_KEY_HERE为有效的API密钥。\n\n您可以在Google Cloud Console中创建API密钥。");
                }
            }, 3000);
            
            // 初始提示
            setTimeout(() => {
                alert("欢迎使用Pneumonoultramicroscopicsilicovolcanoconiosis SuperMap！\n\n这是一个超越Google Maps的增强地图系统，具有：\n1. 3D增强视图\n2. 时间旅行模式\n3. AI预测分析\n4. AR增强现实\n5. 实时数据可视化\n\n点击左侧边栏或各种控制按钮体验增强功能！");
            }, 1000);
        };
        
        // 如果API加载失败
        window.gm_authFailure = function() {
            alert("Google Maps API验证失败。请检查您的API密钥。");
        };
    </script>
    
    <!-- 注意：请将YOUR_API_KEY_HERE替换为您自己的Google Maps API密钥 -->
</body>
</html>
