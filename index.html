<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能AI助手 | 问答与数学计算</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #2563eb;
            --dark-blue: #1e40af;
            --light-blue: #dbeafe;
            --ai-purple: #8b5cf6;
            --math-green: #10b981;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
            --text-light: #f1f5f9;
            --text-gray: #94a3b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', system-ui, sans-serif;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            line-height: 1.6;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* 头部 */
        header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            position: fixed;
            width: 100%;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary-blue), var(--math-green));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }
        
        /* 主区域 */
        .main-content {
            padding-top: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .hero {
            text-align: center;
            margin-bottom: 60px;
            max-width: 800px;
        }
        
        .hero h1 {
            font-size: 3.2rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, var(--primary-blue), var(--math-green), var(--ai-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1.2;
        }
        
        .hero p {
            font-size: 1.2rem;
            color: var(--text-gray);
            margin-bottom: 30px;
        }
        
        .capabilities {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .capability-tag {
            background: var(--card-bg);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(37, 99, 235, 0.3);
        }
        
        .capability-tag i {
            margin-right: 8px;
            color: var(--math-green);
        }
        
        /* 聊天容器 */
        .chat-container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            margin-bottom: 60px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chat-header {
            background: linear-gradient(90deg, var(--primary-blue), var(--math-green));
            padding: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-header-left {
            display: flex;
            align-items: center;
        }
        
        .chat-header i {
            font-size: 2rem;
            margin-right: 15px;
        }
        
        .chat-header h2 {
            font-size: 1.8rem;
        }
        
        .ai-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: #10b981;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .chat-messages {
            height: 450px;
            padding: 25px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .message {
            margin-bottom: 25px;
            display: flex;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ai-message {
            align-items: flex-start;
        }
        
        .ai-avatar {
            background: linear-gradient(135deg, var(--primary-blue), var(--ai-purple));
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .user-message {
            justify-content: flex-end;
        }
        
        .user-avatar {
            background: linear-gradient(135deg, var(--math-green), #059669);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 15px;
            flex-shrink: 0;
        }
        
        .message-content {
            max-width: 75%;
            padding: 18px;
            border-radius: 18px;
            line-height: 1.5;
        }
        
        .ai-message .message-content {
            background: rgba(37, 99, 235, 0.15);
            border-radius: 18px 18px 18px 5px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .user-message .message-content {
            background: rgba(16, 185, 129, 0.15);
            border-radius: 18px 18px 5px 18px;
            border-right: 4px solid var(--math-green);
            text-align: right;
        }
        
        .message-content.math-result {
            background: rgba(16, 185, 129, 0.2);
            border-left: 4px solid var(--math-green);
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
        }
        
        .message-content h4 {
            margin-bottom: 8px;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
        }
        
        .message-content h4 i {
            margin-right: 8px;
        }
        
        .message-time {
            font-size: 0.8rem;
            color: var(--text-gray);
            margin-top: 8px;
            text-align: right;
        }
        
        .chat-input-container {
            padding: 25px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--card-bg);
        }
        
        .input-area {
            display: flex;
            gap: 15px;
        }
        
        .chat-input {
            flex: 1;
            padding: 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            resize: none;
            min-height: 60px;
            font-family: inherit;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }
        
        .send-button {
            background: linear-gradient(135deg, var(--primary-blue), var(--math-green));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 0 30px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1.1rem;
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3);
        }
        
        .send-button i {
            margin-right: 8px;
        }
        
        .quick-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
        }
        
        .quick-action {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            padding: 10px 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }
        
        .quick-action:hover {
            background: rgba(37, 99, 235, 0.2);
            border-color: var(--primary-blue);
        }
        
        /* 数学专用区域 */
        .math-section {
            width: 100%;
            max-width: 900px;
            margin-bottom: 60px;
        }
        
        .math-section h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            color: var(--math-green);
        }
        
        .math-section h3 i {
            margin-right: 12px;
        }
        
        .math-examples {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .math-example {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(16, 185, 129, 0.2);
            transition: transform 0.3s, border-color 0.3s;
            cursor: pointer;
        }
        
        .math-example:hover {
            transform: translateY(-5px);
            border-color: var(--math-green);
        }
        
        .math-example h4 {
            color: var(--math-green);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .math-example h4 i {
            margin-right: 10px;
        }
        
        .math-example p {
            color: var(--text-gray);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .math-example code {
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            color: #7dd3fc;
            font-size: 0.9rem;
        }
        
        /* 页脚 */
        footer {
            background: #0a0e17;
            padding: 50px 0 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            text-align: center;
            width: 100%;
        }
        
        .footer-content {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .footer-content p {
            color: var(--text-gray);
            margin-bottom: 20px;
            font-size: 1rem;
        }
        
        .copyright {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--text-gray);
            font-size: 0.9rem;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .chat-messages {
                height: 400px;
            }
            
            .message-content {
                max-width: 85%;
            }
            
            .input-area {
                flex-direction: column;
            }
            
            .send-button {
                padding: 15px;
            }
        }
        
        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-blue);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--dark-blue);
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <i class="fas fa-robot"></i>
                    <span>智能AI助手</span>
                </div>
                <div class="ai-status">
                    <div class="status-dot"></div>
                    <span>在线 | 可回答问题和数学计算</span>
                </div>
            </nav>
        </div>
    </header>

    <!-- 主内容区 -->
    <div class="container">
        <div class="main-content">
            <!-- 标题区域 -->
            <div class="hero">
                <h1>智能AI助手</h1>
                <p>融合自然语言理解与数学计算能力，可回答各类问题并解决数学问题</p>
                
                <div class="capabilities">
                    <div class="capability-tag">
                        <i class="fas fa-calculator"></i>
                        <span>数学计算</span>
                    </div>
                    <div class="capability-tag">
                        <i class="fas fa-brain"></i>
                        <span>智能问答</span>
                    </div>
                    <div class="capability-tag">
                        <i class="fas fa-lightbulb"></i>
                        <span>问题解答</span>
                    </div>
                    <div class="capability-tag">
                        <i class="fas fa-bolt"></i>
                        <span>即时响应</span>
                    </div>
                </div>
            </div>

            <!-- AI对话区域 -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="chat-header-left">
                        <i class="fas fa-robot"></i>
                        <div>
                            <h2>AI对话助手</h2>
                            <p style="font-size: 0.95rem; opacity: 0.9;">可以直接输入数学问题或一般性问题</p>
                        </div>
                    </div>
                    <div class="ai-status">
                        <div class="status-dot"></div>
                        <span>智能模式</span>
                    </div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <!-- 初始欢迎消息 -->
                    <div class="message ai-message">
                        <div class="ai-avatar">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="message-content">
                            <h4><i class="fas fa-robot"></i> AI助手</h4>
                            <p>您好！我是智能AI助手，我可以：</p>
                            <ul style="margin-top: 8px; padding-left: 20px;">
                                <li>解答数学问题（计算、方程、几何等）</li>
                                <li>回答一般性问题（科学、历史、技术等）</li>
                                <li>进行对话交流</li>
                            </ul>
                            <p style="margin-top: 12px;">试试问我："3的平方加4的平方等于多少？" 或 "什么是人工智能？"</p>
                            <div class="message-time">刚刚</div>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-container">
                    <div class="input-area">
                        <textarea class="chat-input" id="userInput" placeholder="输入您的问题或数学表达式... 例如: 15*28 或 '圆的面积公式是什么？'"></textarea>
                        <button class="send-button" id="sendButton">
                            <i class="fas fa-paper-plane"></i>
                            <span>发送</span>
                        </button>
                    </div>
                    
                    <div class="quick-actions">
                        <div class="quick-action" data-question="15*28等于多少？">计算 15×28</div>
                        <div class="quick-action" data-question="3的平方加4的平方是多少？">计算 3²+4²</div>
                        <div class="quick-action" data-question="什么是人工智能？">AI是什么？</div>
                        <div class="quick-action" data-question="计算圆的面积，半径是5">圆面积计算</div>
                        <div class="quick-action" data-question="解方程：2x+5=15">解方程 2x+5=15</div>
                    </div>
                </div>
            </div>

            <!-- 数学示例区域 -->
            <div class="math-section">
                <h3><i class="fas fa-calculator"></i> 数学问题示例</h3>
                <p style="color: var(--text-gray); margin-bottom: 25px;">点击以下示例问题，AI助手会立即计算并回答</p>
                
                <div class="math-examples">
                    <div class="math-example" data-question="计算 125 + 378">
                        <h4><i class="fas fa-plus-circle"></i> 基础算术</h4>
                        <p>加法、减法、乘法、除法运算</p>
                        <code>125 + 378 = ?</code>
                    </div>
                    
                    <div class="math-example" data-question="计算 15的平方">
                        <h4><i class="fas fa-superscript"></i> 幂运算</h4>
                        <p>平方、立方、开方等运算</p>
                        <code>15² = ?</code>
                    </div>
                    
                    <div class="math-example" data-question="计算 半径为7的圆的面积">
                        <h4><i class="fas fa-circle"></i> 几何计算</h4>
                        <p>面积、周长、体积计算</p>
                        <code>半径7的圆面积 = ?</code>
                    </div>
                    
                    <div class="math-example" data-question="解方程：3x + 7 = 22">
                        <h4><i class="fas fa-equals"></i> 代数方程</h4>
                        <p>一元一次方程求解</p>
                        <code>3x + 7 = 22</code>
                    </div>
                    
                    <div class="math-example" data-question="计算 30% of 250">
                        <h4><i class="fas fa-percentage"></i> 百分比计算</h4>
                        <p>百分比、折扣、增长率</p>
                        <code>250的30% = ?</code>
                    </div>
                    
                    <div class="math-example" data-question="计算 直角三角形斜边，直角边为3和4">
                        <h4><i class="fas fa-shapes"></i> 三角函数</h4>
                        <p>勾股定理、三角函数计算</p>
                        <code>直角边3,4 → 斜边 = ?</code>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <p>智能AI助手 - 融合自然语言处理与数学计算能力的前端AI系统</p>
                <p>所有计算和回答均在浏览器本地执行，无需连接服务器</p>
                <div class="copyright">
                    &copy; 2023 智能AI助手 | 设计：Anson
                </div>
            </div>
        </div>
    </footer>

    <script>
        // AI助手核心功能
        document.addEventListener('DOMContentLoaded', function() {
            const chatMessages = document.getElementById('chatMessages');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            
            // 获取当前时间
            function getCurrentTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            // 添加消息到聊天窗口
            function addMessage(content, isUser = false, isMath = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'ai-message'}`;
                
                // 头像
                const avatarDiv = document.createElement('div');
                avatarDiv.className = isUser ? 'user-avatar' : 'ai-avatar';
                
                const avatarIcon = document.createElement('i');
                avatarIcon.className = isUser ? 'fas fa-user' : 'fas fa-robot';
                avatarDiv.appendChild(avatarIcon);
                
                // 消息内容
                const messageContent = document.createElement('div');
                messageContent.className = 'message-content';
                if (isMath) messageContent.classList.add('math-result');
                
                const messageHeader = document.createElement('h4');
                const headerIcon = document.createElement('i');
                headerIcon.className = isUser ? 'fas fa-user' : 'fas fa-robot';
                messageHeader.appendChild(headerIcon);
                messageHeader.appendChild(document.createTextNode(isUser ? '您' : 'AI助手'));
                
                messageContent.appendChild(messageHeader);
                
                // 消息正文
                const messageText = document.createElement('div');
                messageText.innerHTML = content;
                messageContent.appendChild(messageText);
                
                // 消息时间
                const messageTime = document.createElement('div');
                messageTime.className = 'message-time';
                messageTime.textContent = getCurrentTime();
                messageContent.appendChild(messageTime);
                
                // 组装消息
                if (isUser) {
                    messageDiv.appendChild(messageContent);
                    messageDiv.appendChild(avatarDiv);
                } else {
                    messageDiv.appendChild(avatarDiv);
                    messageDiv.appendChild(messageContent);
                }
                
                chatMessages.appendChild(messageDiv);
                
                // 滚动到最新消息
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // 智能数学计算函数
            function calculateMathExpression(expression) {
                // 清理表达式
                expression = expression.replace(/[。，？?]/g, '').trim();
                
                // 检查是否包含常见数学关键词
                const mathKeywords = {
                    '平方': '**2',
                    '立方': '**3',
                    '开方': 'Math.sqrt',
                    '根号': 'Math.sqrt',
                    'sin': 'Math.sin',
                    'cos': 'Math.cos',
                    'tan': 'Math.tan',
                    'π': 'Math.PI',
                    'pi': 'Math.PI',
                    '面积': 'area',
                    '周长': 'perimeter',
                    '体积': 'volume'
                };
                
                // 替换中文运算符
                expression = expression
                    .replace(/乘以/g, '*')
                    .replace(/乘/g, '*')
                    .replace(/除以/g, '/')
                    .replace(/除/g, '/')
                    .replace(/加/g, '+')
                    .replace(/加上/g, '+')
                    .replace(/减/g, '-')
                    .replace(/减去/g, '-')
                    .replace(/等于/g, '=')
                    .replace(/的平方/g, '**2')
                    .replace(/的立方/g, '**3');
                
                // 处理百分比
                expression = expression.replace(/(\d+)%/g, '($1/100)');
                
                // 处理分数
                expression = expression.replace(/(\d+)\/(\d+)/g, '($1/$2)');
                
                // 处理常见问题类型
                let result;
                
                // 1. 基础算术运算
                if (/^[\d\+\-\*\/\.\s\(\)]+$/.test(expression.replace(/\s/g, ''))) {
                    try {
                        // 安全地评估数学表达式
                        result = eval(expression);
                        // 处理浮点数精度
                        if (typeof result === 'number') {
                            // 如果是整数，直接显示整数
                            if (Number.isInteger(result)) {
                                return result.toString();
                            } else {
                                // 保留4位小数
                                return parseFloat(result.toFixed(4)).toString();
                            }
                        }
                        return result.toString();
                    } catch (e) {
                        return "无法计算此表达式";
                    }
                }
                
                // 2. 方程求解
                if (expression.includes('=')) {
                    try {
                        const sides = expression.split('=');
                        if (sides.length === 2) {
                            const left = sides[0].trim();
                            const right = sides[1].trim();
                            
                            // 简单的一元一次方程
                            if (left.includes('x') && !left.includes('x**2')) {
                                // 提取系数
                                const coeffMatch = left.match(/([-+]?\d*)\s*x/);
                                if (coeffMatch) {
                                    const coeff = coeffMatch[1] === '' || coeffMatch[1] === '+' ? 1 : 
                                                 coeffMatch[1] === '-' ? -1 : parseInt(coeffMatch[1]);
                                    
                                    // 提取常数项
                                    const constantMatch = left.match(/([-+]?\d+)(?!\s*x)/);
                                    let constant = constantMatch ? parseInt(constantMatch[0]) : 0;
                                    
                                    // 计算x的值
                                    const rightNum = parseInt(right);
                                    const xValue = (rightNum - constant) / coeff;
                                    
                                    return `x = ${xValue}`;
                                }
                            }
                        }
                    } catch (e) {
                        // 方程解析失败，继续其他方法
                    }
                }
                
                // 3. 几何计算
                if (expression.includes('圆') || expression.includes('面积') || expression.includes('周长')) {
                    // 提取数字
                    const numbers = expression.match(/\d+(\.\d+)?/g);
                    if (numbers) {
                        const radius = parseFloat(numbers[0]);
                        
                        if (expression.includes('面积')) {
                            const area = Math.PI * radius * radius;
                            return `面积 = π × r² = ${Math.PI.toFixed(2)} × ${radius}² ≈ ${area.toFixed(2)}`;
                        }
                        
                        if (expression.includes('周长')) {
                            const perimeter = 2 * Math.PI * radius;
                            return `周长 = 2 × π × r = 2 × ${Math.PI.toFixed(2)} × ${radius} ≈ ${perimeter.toFixed(2)}`;
                        }
                    }
                }
                
                // 4. 勾股定理
                if (expression.includes('直角') || expression.includes('斜边')) {
                    const numbers = expression.match(/\d+(\.\d+)?/g);
                    if (numbers && numbers.length >= 2) {
                        const a = parseFloat(numbers[0]);
                        const b = parseFloat(numbers[1]);
                        const c = Math.sqrt(a*a + b*b);
                        return `斜边 = √(a² + b²) = √(${a}² + ${b}²) = √(${a*a + b*b}) ≈ ${c.toFixed(2)}`;
                    }
                }
                
                // 5. 幂运算
                if (expression.includes('**') || expression.includes('^')) {
                    try {
                        const baseMatch = expression.match(/(\d+)(?:\s*[的]?\s*(?:平方|立方|\*\*2|\*\*3|\^2|\^3))/);
                        const powerMatch = expression.match(/(?:平方|\*\*2|\^2)/) ? 2 :
                                          expression.match(/(?:立方|\*\*3|\^3)/) ? 3 : null;
                        
                        if (baseMatch && powerMatch) {
                            const base = parseInt(baseMatch[1]);
                            const result = Math.pow(base, powerMatch);
                            return `${base}${powerMatch === 2 ? '²' : '³'} = ${result}`;
                        }
                    } catch (e) {
                        // 幂运算解析失败
                    }
                }
                
                // 如果以上都不匹配，尝试直接计算
                try {
                    // 移除所有非数学字符
                    const cleanExpr = expression.replace(/[^0-9\+\-\*\/\(\)\.]/g, '');
                    if (cleanExpr.length > 0) {
                        const evalResult = eval(cleanExpr);
                        if (typeof evalResult === 'number') {
                            return Number.isInteger(evalResult) ? 
                                   evalResult.toString() : 
                                   evalResult.toFixed(4).toString();
                        }
                    }
                } catch (e) {
                    // 最终计算失败
                }
                
                return null; // 无法计算
            }
            
            // AI知识库
            const aiKnowledgeBase = {
                // 数学相关
                '数学': '数学是研究数量、结构、变化以及空间等概念的学科。现代数学已发展出众多分支，如代数、几何、分析、概率等。',
                '代数': '代数是数学的一个分支，研究数字、符号和它们之间的运算规则，主要涉及方程、多项式、群、环、域等结构。',
                '几何': '几何是研究空间形状、大小、相对位置等性质的数学分支，包括欧几里得几何、解析几何、微分几何等。',
                '微积分': '微积分是研究变化和累积的数学分支，包括微分学和积分学，由牛顿和莱布尼茨独立发展。',
                
                // AI相关
                '人工智能': '人工智能是计算机科学的一个分支，旨在创建能够执行通常需要人类智能的任务的机器。包括机器学习、自然语言处理、计算机视觉等领域。',
                '机器学习': '机器学习是人工智能的子领域，使计算机能够从数据中学习并做出预测或决策，而无需明确编程。',
                '深度学习': '深度学习是机器学习的一个分支，使用多层神经网络来学习数据的复杂模式，在图像识别、自然语言处理等领域表现出色。',
                
                // 科学相关
                '物理': '物理学是研究物质、能量以及它们之间相互作用的基础科学。主要分支包括力学、电磁学、热力学、量子力学等。',
                '化学': '化学是研究物质的组成、结构、性质、变化以及变化规律的科学。主要分支包括有机化学、无机化学、物理化学、分析化学等。',
                '生物': '生物学是研究生命现象和生命活动规律的科学。包括分子生物学、细胞生物学、遗传学、生态学等分支。',
                
                // 通用知识
                '地球': '地球是太阳系中由内及外的第三颗行星，是宇宙中已知唯一孕育和支持生命的天体。表面约71%被水覆盖，其余为陆地。',
                '太阳': '太阳是太阳系的中心天体，是一颗黄矮星，提供了地球上生命所需的光和热。它的直径约为1,392,000公里。',
                '宇宙': '宇宙是所有时间、空间、物质和能量的总和。根据大爆炸理论，宇宙诞生于约138亿年前，并一直在膨胀。'
            };
            
            // 查找相关知识
            function findRelatedKnowledge(question) {
                question = question.toLowerCase();
                
                // 检查是否有直接匹配的关键词
                for (const [keyword, knowledge] of Object.entries(aiKnowledgeBase)) {
                    if (question.includes(keyword.toLowerCase())) {
                        return knowledge;
                    }
                }
                
                // 检查常见问题模式
                if (question.includes('什么是') || question.includes('啥是') || question.includes('解释')) {
                    for (const [keyword, knowledge] of Object.entries(aiKnowledgeBase)) {
                        if (question.includes(keyword.toLowerCase())) {
                            return `关于"${keyword}"：${knowledge}`;
                        }
                    }
                }
                
                if (question.includes('谁发明') || question.includes('谁发现')) {
                    if (question.includes('微积分')) {
                        return '微积分主要由艾萨克·牛顿和戈特弗里德·威廉·莱布尼茨在17世纪独立发展。';
                    }
                    if (question.includes('相对论') || question.includes('爱因斯坦')) {
                        return '阿尔伯特·爱因斯坦在1905年提出狭义相对论，1915年提出广义相对论。';
                    }
                    if (question.includes('电话')) {
                        return '电话的发明通常归功于亚历山大·格拉汉姆·贝尔，他于1876年获得了第一项电话专利。';
                    }
                }
                
                if (question.includes('如何') || question.includes('怎样')) {
                    if (question.includes('学习') && question.includes('数学')) {
                        return '学习数学的有效方法：1) 理解基础概念 2) 大量练习 3) 解决实际问题 4) 与他人讨论 5) 保持耐心和毅力。';
                    }
                    if (question.includes('计算')) {
                        return '要计算数学问题，可以：1) 明确问题 2) 识别已知和未知 3) 选择合适公式或方法 4) 逐步计算 5) 验证结果。';
                    }
                }
                
                // 如果没有找到相关知识，返回通用回答
                const genericResponses = [
                    "这是一个有趣的问题，但我需要更多信息来提供准确的回答。",
                    "我目前的知识库可能没有这个问题的详细信息，但我可以帮您计算数学问题或回答其他类型的问题。",
                    "关于这个问题，我建议查阅专业资料获取更全面的信息。同时，我可以帮您解决数学计算问题。",
                    "这个问题涉及到一些专业知识，我目前的知识库可能不够完整。您可以尝试问我数学计算或其他一般性问题。"
                ];
                
                return genericResponses[Math.floor(Math.random() * genericResponses.length)];
            }
            
            // 处理用户输入
            function processUserInput(input) {
                const trimmedInput = input.trim();
                if (!trimmedInput) return;
                
                // 添加用户消息
                addMessage(trimmedInput, true);
                
                // 清空输入框
                userInput.value = '';
                
                // AI思考中...
                setTimeout(() => {
                    let aiResponse;
                    
                    // 1. 首先尝试数学计算
                    const mathResult = calculateMathExpression(trimmedInput);
                    
                    if (mathResult !== null) {
                        // 数学计算成功
                        aiResponse = `<strong>计算结果：</strong><br>${trimmedInput} = <strong>${mathResult}</strong>`;
                        addMessage(aiResponse, false, true);
                        return;
                    }
                    
                    // 2. 如果不是数学问题，尝试从知识库回答
                    aiResponse = findRelatedKnowledge(trimmedInput);
                    addMessage(aiResponse, false);
                    
                }, 800); // 模拟AI思考时间
            }
            
            // 发送按钮事件
            sendButton.addEventListener('click', () => {
                processUserInput(userInput.value);
            });
            
            // 输入框回车事件
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    processUserInput(userInput.value);
                }
            });
            
            // 快捷操作按钮
            document.querySelectorAll('.quick-action').forEach(button => {
                button.addEventListener('click', () => {
                    const question = button.getAttribute('data-question');
                    userInput.value = question;
                    processUserInput(question);
                });
            });
            
            // 数学示例点击
            document.querySelectorAll('.math-example').forEach(example => {
                example.addEventListener('click', () => {
                    const question = example.getAttribute('data-question');
                    userInput.value = question;
