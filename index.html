<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ansonçš„è‡ªè¨‚ç´…åŒ…ç”Ÿæˆå™¨</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #f9f4e6 0%, #f5e9d3 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(to right, #d32f2f, #f44336);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: -40px -40px 40px -40px;
        }
        .generator-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #495057;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ced4da;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .form-group input:focus, .form-group textarea:focus {
            border-color: #d32f2f;
            outline: none;
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);
        }
        .amount-hint {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
        .negative-amount { color: #2e7d32; font-weight: bold; }
        .small-amount { color: #f44336; font-weight: bold; }
        .generate-btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(to right, #1971c2, #1c7ed6);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }
        .generate-btn:hover {
            background: linear-gradient(to right, #1864ab, #1971c2);
            transform: translateY(-2px);
        }
        .link-display {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            border-left: 5px solid #4CAF50;
            word-break: break-all;
            display: none;
        }
        .link-display.show {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .redpacket-card {
            background: #fff9f9;
            border: 2px dashed #f44336;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        .claim-btn {
            display: inline-block;
            padding: 18px 50px;
            background: linear-gradient(to right, #d32f2f, #f44336);
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-size: 1.5rem;
            font-weight: bold;
            margin: 20px 0;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.3);
            border: none;
            cursor: pointer;
        }
        .claim-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(244, 67, 54, 0.4);
        }
        .share-section {
            background: #e8f5e9;
            padding: 25px;
            border-radius: 15px;
            margin-top: 40px;
            text-align: center;
        }
        .share-btn {
            display: inline-block;
            margin: 10px;
            padding: 10px 20px;
            background: #2196F3;
            color: white;
            border-radius: 8px;
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
        }
        .mode-switcher {
            text-align: center;
            margin: 20px 0;
        }
        .mode-btn {
            padding: 10px 25px;
            margin: 0 10px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }
        .mode-btn.active {
            background: #d32f2f;
        }
        #directClaimPanel {
            display: none;
            text-align: center;
            padding: 20px;
            background: #fff3cd;
            border-radius: 10px;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é é¢æ¨™é¡Œ -->
        <div class="header">
            <h1 id="mainTitle">ğŸ‰ Ansonçš„è‡ªè¨‚ç´…åŒ…ç”Ÿæˆå™¨ ğŸ‰</h1>
            <p id="subTitle">è‡ªè¨‚é‡‘é¡èˆ‡ç¥ç¦ï¼Œç”Ÿæˆå°ˆå±¬é€£çµåˆ†äº«çµ¦æœ‹å‹</p>
        </div>

        <!-- æ¨¡å¼åˆ‡æ›å™¨ (åƒ…åœ¨ç”Ÿæˆå™¨æ¨¡å¼é¡¯ç¤º) -->
        <div class="mode-switcher" id="modeSwitcher">
            <button class="mode-btn active" onclick="switchMode('generator')">ğŸ› ï¸ ç´…åŒ…ç”Ÿæˆå™¨</button>
            <button class="mode-btn" onclick="switchMode('preview')">ğŸ‘€ é è¦½ç•¶å‰ç´…åŒ…</button>
        </div>

        <!-- ===== ç´…åŒ…ç”Ÿæˆå™¨é¢æ¿ ===== -->
        <div id="generatorPanel">
            <div class="generator-panel">
                <h2>ğŸ› ï¸ è‡ªè¨‚ä½ çš„ç´…åŒ…</h2>
                <p>å¡«å¯«ä»¥ä¸‹ä¿¡æ¯ï¼Œç”Ÿæˆä¸€å€‹å°ˆå±¬çš„ç´…åŒ…é€£çµã€‚ä½ å¯ä»¥å°‡é€£çµåˆ†äº«çµ¦æœ‹å‹ï¼Œä»–é»é–‹å¾Œæœƒç›´æ¥çœ‹åˆ°é€™å€‹ç´…åŒ…ï¼</p>
                
                <div class="form-group">
                    <label for="redpacketAmount">ç´…åŒ…é‡‘é¡</label>
                    <input type="number" id="redpacketAmount" step="0.01" value="-100" placeholder="ä¾‹å¦‚: -100, 0.01, 888">
                    <div class="amount-hint">
                        å¯ä»¥è¨­ç½®ç‚ºè² æ•¸ï¼ˆå¦‚<span class="negative-amount"> -100å…ƒ</span>ï¼‰è¡¨ç¤ºã€Œå€’æ¬ æ¬¾ã€å„ªæƒ åˆ¸ï¼Œæˆ–æ¥µå°é‡‘é¡ï¼ˆå¦‚<span class="small-amount"> 0.01å…ƒ</span>ï¼‰ã€‚
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="redpacketName">ç´…åŒ…åç¨±</label>
                    <input type="text" id="redpacketName" value="å‹æƒ…è€ƒé©—å„ªæƒ åˆ¸" placeholder="ä¾‹å¦‚: æ–°å¹´ç¥ç¦ã€å‹æƒ…è€ƒé©—åˆ¸">
                </div>
                
                <div class="form-group">
                    <label for="redpacketMessage">ç¥ç¦èª/è¨Šæ¯</label>
                    <textarea id="redpacketMessage" rows="3" placeholder="è¼¸å…¥ä½ æƒ³å°æœ‹å‹èªªçš„è©±">é»æ“Šé ˜å–ä½ çš„å°ˆå±¬ã€Œå„ªæƒ åˆ¸ã€ï¼Œçœ‹çœ‹æ˜¯é©šå–œé‚„æ˜¯é©šåš‡ï¼å‹æƒ…å¤§è€ƒé©—ï¼</textarea>
                </div>
                
                <div class="form-group">
                    <label for="redpacketCode">é ˜å–ç¢¼ (å¯ç•™ç©ºéš¨æ©Ÿç”Ÿæˆ)</label>
                    <input type="text" id="redpacketCode" placeholder="ä¾‹å¦‚: RP-2023-LUCKY" value="RP-100-DEBT">
                </div>

                <button class="generate-btn" onclick="generateRedPacketLink()">
                    ğŸ”— ç”Ÿæˆç´…åŒ…é€£çµä¸¦é è¦½
                </button>
            </div>

            <!-- ç”Ÿæˆçš„é€£çµé¡¯ç¤ºå€åŸŸ -->
            <div class="link-display" id="linkDisplay">
                <h3>âœ… ä½ çš„å°ˆå±¬ç´…åŒ…é€£çµå·²ç”Ÿæˆï¼</h3>
                <p>è¤‡è£½ä¸‹æ–¹é€£çµï¼Œåˆ†äº«çµ¦ä½ çš„æœ‹å‹ï¼š</p>
                <div id="generatedLink" style="padding: 15px; background: white; border-radius: 8px; margin: 15px 0; font-family: monospace;"></div>
                <div>
                    <button class="share-btn" onclick="copyGeneratedLink()">ğŸ“‹ è¤‡è£½é€£çµ</button>
                    <button class="share-btn" style="background: #d32f2f;" onclick="testGeneratedLink()">ğŸ æ¸¬è©¦æ‰“é–‹é€£çµ</button>
                </div>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">
                    <strong>æç¤ºï¼š</strong> æœ‹å‹é»é–‹æ­¤é€£çµå¾Œï¼Œæœƒ<b>ç›´æ¥çœ‹åˆ°ç´…åŒ…é ˜å–å½ˆçª—</b>ï¼Œè€Œéæ­¤ç·¨è¼¯é é¢ã€‚
                </p>
            </div>

            <!-- ç›´æ¥é ˜å–æ¸¬è©¦é¢æ¿ -->
            <div id="directClaimPanel">
                <h3>ğŸ‘€ é è¦½ä½ å‰›è¨­å®šçš„ç´…åŒ…</h3>
                <p>é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œæ¨¡æ“¬æœ‹å‹æ‰“é–‹é€£çµå¾Œçœ‹åˆ°çš„æ¨£å­ï¼š</p>
                <button class="claim-btn" onclick="claimRedPacket(true)">ç«‹å³é è¦½é ˜å–ç´…åŒ…</button>
            </div>

            <!-- ä¿ç•™ä½ åŸæœ‰çš„è®€æ›¸æœƒè³‡æºå€å¡Š -->
            <h2>ğŸ“š è®€æ›¸æœƒè³‡æº</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 30px 0;">
                <div style="background: #f0f7ff; padding: 20px; border-radius: 10px;">
                    <h4>ğŸ“– å¥½æ›¸æ¨è–¦</h4>
                    <p>è®€æ›¸æœƒåˆ†äº«çš„å„ªè³ªæ›¸ç±</p>
                    <div style="color: #1971c2; margin-top: 10px;">æŸ¥çœ‹æ¸…å–® â†’</div>
                </div>
                <div style="background: #fff0f6; padding: 20px; border-radius: 10px;">
                    <h4>ğŸ¯ å­¸ç¿’è³‡æº</h4>
                    <p>è€ƒè©¦æº–å‚™èˆ‡å­¸ç¿’æŠ€å·§</p>
                    <div style="color: #c2255c; margin-top: 10px;">å‰å¾€æŸ¥çœ‹ â†’</div>
                </div>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h4>ğŸ‘¥ æˆå“¡äº¤æµ</h4>
                    <p>è®€æ›¸æœƒæˆå“¡äº’å‹•å€</p>
                    <div style="color: #495057; margin-top: 10px;">åƒèˆ‡è¨è«– â†’</div>
                </div>
            </div>

            <!-- ä¿ç•™ä½ åŸæœ‰çš„åˆ†äº«å€å¡Š -->
            <div class="share-section">
                <h3>ğŸ”— åˆ†äº«æ­¤ç”Ÿæˆå™¨é é¢</h3>
                <p>å°‡é€™å€‹ç´…åŒ…ç”Ÿæˆå™¨åˆ†äº«çµ¦å…¶ä»–åŒå­¸ï¼š</p>
                <p><strong>é é¢ç¶²å€ï¼š</strong><br><span id="page-url">è¼‰å…¥ä¸­...</span></p>
                <div>
                    <button onclick="copyPageUrl()" class="share-btn">ğŸ“‹ è¤‡è£½ç”Ÿæˆå™¨é€£çµ</button>
                    <button onclick="shareToWhatsApp()" class="share-btn">ğŸ’¬ åˆ†äº«åˆ° WhatsApp</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== æ ¸å¿ƒåŠŸèƒ½ï¼šè®€å–ç¶²å€åƒæ•¸ =====
        function getUrlParams() {
            const params = {};
            const queryString = window.location.search.substring(1);
            if (!queryString) return null; // å¦‚æœæ²’æœ‰åƒæ•¸ï¼Œè¿”å›nullè¡¨ç¤ºæ˜¯ç”Ÿæˆå™¨æ¨¡å¼

            const pairs = queryString.split('&');
            for (const pair of pairs) {
                const [key, value] = pair.split('=');
                if (key && value) {
                    params[key] = decodeURIComponent(value.replace(/\+/g, ' '));
                }
            }
            return params;
        }

        // ===== é é¢åˆå§‹åŒ– =====
        document.addEventListener('DOMContentLoaded', function() {
            // é¡¯ç¤ºç•¶å‰é é¢ç¶²å€
            document.getElementById('page-url').textContent = window.location.href;

            // æª¢æŸ¥ç¶²å€åƒæ•¸ï¼Œåˆ¤æ–·ç•¶å‰æ˜¯ã€Œç”Ÿæˆå™¨æ¨¡å¼ã€é‚„æ˜¯ã€Œé ˜å–é é¢æ¨¡å¼ã€
            const urlParams = getUrlParams();
            
            if (urlParams) {
                // æ¨¡å¼2: é ˜å–é é¢æ¨¡å¼ - ç¶²å€å¸¶æœ‰åƒæ•¸ï¼Œç›´æ¥é¡¯ç¤ºç´…åŒ…é ˜å–å½ˆçª—
                console.log('é ˜å–é é¢æ¨¡å¼ï¼Œåƒæ•¸:', urlParams);
                document.getElementById('mainTitle').textContent = 'ğŸ ä½ æ”¶åˆ°ä¸€å€‹ç´…åŒ…ï¼';
                document.getElementById('subTitle').textContent = 'ä¾†è‡ª Anson çš„å°ˆå±¬ç¥ç¦';
                document.getElementById('modeSwitcher').style.display = 'none';
                document.getElementById('generatorPanel').style.display = 'none';
                
                // å»¶é²ä¸€ä¸‹ï¼Œç¢ºä¿é é¢æ¸²æŸ“å®Œæˆå¾Œå†å½ˆå‡ºè¦–çª—
                setTimeout(() => {
                    claimRedPacket(false, urlParams);
                }, 500);
                
            } else {
                // æ¨¡å¼1: ç”Ÿæˆå™¨æ¨¡å¼ - æ™®é€šæ‰“é–‹ï¼Œé¡¯ç¤ºç·¨è¼¯å™¨
                console.log('ç”Ÿæˆå™¨æ¨¡å¼');
                // åˆå§‹åŒ–é è¦½é¢æ¿
                updateDirectClaimPreview();
            }
        });

        // ===== ç´…åŒ…ç”Ÿæˆå™¨åŠŸèƒ½ =====
        function generateRedPacketLink() {
            const amount = document.getElementById('redpacketAmount').value;
            const name = document.getElementById('redpacketName').value;
            const message = document.getElementById('redpacketMessage').value;
            let code = document.getElementById('redpacketCode').value;
            
            // å¦‚æœæœªå¡«å¯«é ˜å–ç¢¼ï¼Œå‰‡ç”Ÿæˆä¸€å€‹éš¨æ©Ÿçš„
            if (!code) {
                code = 'RP-' + Math.random().toString(36).substring(2, 8).toUpperCase();
                document.getElementById('redpacketCode').value = code;
            }
            
            // æ§‹å»ºåŒ…å«ç´…åŒ…ä¿¡æ¯çš„ç¶²å€åƒæ•¸
            const params = new URLSearchParams({
                amount: amount,
                name: encodeURIComponent(name),
                message: encodeURIComponent(message),
                code: code,
                t: Date.now() // æ·»åŠ æ™‚é–“æˆ³é˜²æ­¢ç·©å­˜
            });
            
            // ç”Ÿæˆå®Œæ•´çš„ç´…åŒ…é ˜å–é€£çµï¼ˆå°±æ˜¯ç•¶å‰é é¢ç¶²å€ + åƒæ•¸ï¼‰
            const baseUrl = window.location.href.split('?')[0];
            const redpacketUrl = `${baseUrl}?${params.toString()}`;
            
            // é¡¯ç¤ºç”Ÿæˆçš„é€£çµ
            document.getElementById('generatedLink').textContent = redpacketUrl;
            document.getElementById('linkDisplay').classList.add('show');
            document.getElementById('directClaimPanel').style.display = 'block';
            
            // æ›´æ–°ç›´æ¥é ˜å–é è¦½çš„æ•¸æ“š
            updateDirectClaimPreview();
            
            // æ»¾å‹•åˆ°é€£çµé¡¯ç¤ºå€åŸŸ
            document.getElementById('linkDisplay').scrollIntoView({ behavior: 'smooth' });
        }

        function updateDirectClaimPreview() {
            // æ­¤å‡½å¼ç”¨æ–¼æ›´æ–°ã€Œé è¦½ã€é¢æ¿ä¸­çš„ä¿¡æ¯æç¤º
            const amount = document.getElementById('redpacketAmount').value;
            const name = document.getElementById('redpacketName').value;
            const amountDisplay = parseFloat(amount) < 0 ? 
                `<span class="negative-amount">${amount} å…ƒ</span>` : 
                `<span class="small-amount">${amount} å…ƒ</span>`;
            
            const previewText = `ç•¶å‰è¨­å®š: ${name} (${amountDisplay})`;
            const previewPanel = document.getElementById('directClaimPanel');
            if (previewPanel.querySelector('p:nth-child(2)')) {
                previewPanel.querySelector('p:nth-child(2)').innerHTML = previewText;
            }
        }

        // ===== é€£çµæ“ä½œåŠŸèƒ½ =====
        function copyGeneratedLink() {
            const linkText = document.getElementById('generatedLink').textContent;
            navigator.clipboard.writeText(linkText).then(() => {
                alert('âœ… å·²è¤‡è£½ç´…åŒ…é€£çµåˆ°å‰ªè²¼ç°¿ï¼\n\nä½ å¯ä»¥ç›´æ¥è²¼ä¸Šåˆ†äº«çµ¦æœ‹å‹äº†ã€‚');
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—:', err);
                alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–ä¸¦è¤‡è£½é€£çµã€‚');
            });
        }

        function testGeneratedLink() {
            const linkText = document.getElementById('generatedLink').textContent;
            if (linkText) {
                window.open(linkText, '_blank');
            }
        }

        function copyPageUrl() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('å·²è¤‡è£½ç”Ÿæˆå™¨é é¢é€£çµåˆ°å‰ªè²¼ç°¿ï¼');
            });
        }

        // ===== ç´…åŒ…é ˜å–/é¡¯ç¤ºåŠŸèƒ½ (ä¸€é«”å…©ç”¨) =====
        function claimRedPacket(isPreview = false, customParams = null) {
            let amount, name, message, code;
            
            if (customParams) {
                // æƒ…æ³A: å¾ç¶²å€åƒæ•¸è®€å– (åˆ†äº«é€£çµæ‰“é–‹)
                amount = customParams.amount || '0.00';
                name = customParams.name || 'æœªå‘½åç´…åŒ…';
                message = customParams.message || 'æ­å–œï¼';
                code = customParams.code || 'æœªçŸ¥';
            } else {
                // æƒ…æ³B: å¾è¡¨å–®è®€å– (é è¦½æˆ–é é¢ç›´æ¥é ˜å–)
                amount = document.getElementById('redpacketAmount').value || '0.00';
                name = document.getElementById('redpacketName').value || 'æœªå‘½åç´…åŒ…';
                message = document.getElementById('redpacketMessage').value || 'æ­å–œï¼';
                code = document.getElementById('redpacketCode').value || 'RP-XXXX';
            }
            
            // æ ¹æ“šé‡‘é¡æ±ºå®šé¡¯ç¤ºæ¨£å¼
            const isNegative = parseFloat(amount) < 0;
            const amountColor = isNegative ? '#2E7D32' : '#f44336';
            const amountText = isNegative ? 
                `${amount} å…ƒ<br><small style="font-size:1.2rem;">(ä½ ç²å¾—ä¸€å¼µã€Œå€’æ¬ æ¬¾ã€å„ªæƒ åˆ¸)</small>` : 
                `${amount} å…ƒ`;
            
            const titleText = isNegative ? "ğŸ« æ­å–œç²å¾—ã€Œå‹æƒ…è€ƒé©—ã€å„ªæƒ åˆ¸ï¼" : "ğŸŠ ç´…åŒ…é ˜å–æˆåŠŸï¼";
            const buttonText = isPreview ? "é—œé–‰é è¦½" : "é ˜å–å®Œæˆï¼Œé—œé–‰";

            // å‰µå»ºæ¨¡æ…‹å½ˆçª—
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0,0,0,${isPreview ? '0.5' : '0.85'});
                z-index: 9999; display: flex; justify-content: center; align-items: center;
                animation: fadeIn 0.3s;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 40px; border-radius: 20px; text-align: center; max-width: 450px; width: 90%; animation: popIn 0.4s;">
                    <h2 style="color:${amountColor}; margin-bottom: 10px;">${titleText}</h2>
                    <div style="margin: 20px 0;">
                        <span style="background:${isNegative ? '#c8e6c9' : '#ffcdd2'}; color:${isNegative ? '#2E7D32' : '#d32f2f'}; padding: 8px 20px; border-radius: 20px; font-weight: bold;">
                            ${isNegative ? 'å€’æ¬ æ¬¾å„ªæƒ åˆ¸' : 'ç¾é‡‘ç´…åŒ…'}
                        </span>
                    </div>
                    <div style="font-size: 3.5rem; color:${amountColor}; font-weight: bold; margin: 20px 0; line-height: 1.2;">
                        ${amountText}
                    </div>
                    <h3 style="color: #333;">${name}</h3>
                    <p style="color: #666; margin: 20px 0; line-height: 1.6; font-size: 1.1rem;">
                        ${message}
                    </p>
                    <div style="background: #f5f5f5; padding: 15px; border-radius: 12px; margin: 20px 0;">
                        <div style="font-size: 0.95rem; color: #888;">é ˜å–ç¢¼</div>
                        <div style="font-family: monospace; font-size: 1.5rem; letter-spacing: 2px; color: #d32f2f; margin-top: 5px;">${code}</div>
                    </div>
                    <div style="color: #888; font-size: 0.95rem; margin-bottom: 25px;">
                        ä¾†è‡ª: Anson | æœ‰æ•ˆæœŸ: é ˜å–å¾Œ1å¤©å…§æœ‰æ•ˆ
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="padding: 15px 50px; background: ${isNegative ? '#2E7D32' : '#4CAF50'}; color: white; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer;">
                        ${buttonText}
                    </button>
                    ${isPreview ? '<p style="margin-top:15px; color:#999; font-size:0.9rem;">(æ­¤ç‚ºé è¦½ï¼Œæœ‹å‹æ‰“é–‹åˆ†äº«é€£çµæ™‚å°‡ç›´æ¥çœ‹åˆ°æ­¤ç•«é¢)</p>' : ''}
                </div>
            `;
            
            // æ·»åŠ å‹•ç•«æ¨£å¼
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes popIn { 
                    0% { transform: scale(0.8); opacity: 0; }
                    100% { transform: scale(1); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(modal);
            
            // é»æ“ŠèƒŒæ™¯é—œé–‰ (åƒ…é è¦½æ¨¡å¼)
            if (isPreview) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }
        }

        // ===== æ¨¡å¼åˆ‡æ›åŠŸèƒ½ =====
        function switchMode(mode) {
            const genPanel = document.getElementById('generatorPanel');
            const switcher = document.getElementById('modeSwitcher');
            const buttons = switcher.querySelectorAll('.mode-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'generator') {
                // é¡¯ç¤ºç”Ÿæˆå™¨
                document.querySelector('.mode-btn[onclick*="generator"]').classList.add('active');
                genPanel.style.display = 'block';
            } else if (mode === 'preview') {
                // é¡¯ç¤ºé è¦½
                document.querySelector('.mode-btn[onclick*="preview"]').classList.add('active');
                genPanel.style.display = 'none';
                claimRedPacket(true); // ç”¨ç•¶å‰è¡¨å–®å€¼é è¦½
            }
        }

        // ===== åˆ†äº«åŠŸèƒ½ (ä¿ç•™ä½ çš„åŸæœ‰åŠŸèƒ½) =====
        function shareToWhatsApp() {
            const text = `ğŸ‰ Ansonçš„ç´…åŒ…ç”Ÿæˆå™¨ ğŸ‰\n\nç”¨é€™å€‹å·¥å…·è‡ªè¨‚æœ‰è¶£çš„çº¢åŒ…ï¼ˆæ”¯æ´è² æ•¸é‡‘é¡ï¼ï¼‰åˆ†äº«çµ¦æœ‹å‹ï¼š\n${window.location.href}\n\nä¾†è‡ª Anson çš„å‰µæ„åˆ†äº«ï¼`;
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }
    </script>
</body>
</html>
